!function(){"use strict";let e=function(){},t=new e;e.prototype.common=function(){function e(e,t){let a=document.querySelectorAll(".range_val");a&&a.forEach(function(a){a.dataset.key&&a.dataset.key===e&&(a.innerText=(100*t).toString())})}return{time:function(e){return new Date(e).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})},getDateTime:function(e){let t=new Date(parseInt(e)),a=function(e){return t.getHours()>12?e?t.getHours()-12:" PM":e?t.getHours():" AM"};return t.getDate()+" "+["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][t.getMonth()+1]+" AT "+a(!0)+":"+t.getMinutes()+a(!1)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString()||""},getTimeDiff:function(e,t){var a,n,i,s="";let o=t-e;return o<0?"0s":(o=Math.abs(o),i=Math.floor(o/864e5|0),n=Math.floor(o/36e5|0),i>0&&(s+=i+"d ",n-=24*i),n>0&&(s+=n+"h "),(a=Math.floor(o%36e5/6e4|0))>0&&(s+=a+"m "),s+=Math.floor(o%6e4/1e3|0)+"s")},timeDiff:function(e,t,a,n=!1){let i=new Date(e).getTime(),s=new Date(t).getTime(),o=0;if(n&&(s=Date.now()),isNaN(i)||isNaN(s))return"";o=i<s?s-i:i-s;var r=Math.floor(o/1e3/60),c=(Math.floor(r/60),Math.floor(o/1e3/60/1440)),l=new Date(o);return"day"===a?c:"hour"===a?l.getHours()>0?l.getHours():0:"minute"===a?r:0},getUrlPath:function(e="",t="path"){try{let a=new URL(e&&""!==e?e:document.location.href);if("domain"===t)return a.origin;if("path"===t)return a.pathname}catch(t){return e}return""},timeAgo:function(e){if(!e)return"";var t=new Date(parseInt(e)),a=new Date-t,n=Math.floor(a/864e5),i=Math.floor(a%864e5/36e5),s=Math.round(a%864e5%36e5/6e4);return n>0?n>1?n+" days ago":n+" day ago":i>0?i>1?i+" hours ago ":i+" hour ago":s>0?s>1?s+" mins ago ":s+" min ago":t.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})},whiteSpaces:function(e){return function(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return e.replace(/[&<>"'\/]/gi,e=>t[e])}(e.split(" ").filter(e=>e).join(" "))},loader:function(e="on"){if("off"===e){let e=document.querySelectorAll(".mr-loader");return e&&e.forEach(e=>e.remove()),""}{const e=document.createElement("DIV");return e.setAttribute("class","mr-loader"),e.innerHTML="<div></div><div></div>",e}},setOptionConfig:function(t,a){if(!a)return;const n=document.querySelectorAll(t);for(var i=0;i<n.length;i++){var s=n[i].dataset.action,o=n[i].dataset.key;if("text"===s&&(n[i].value=a[o]&&""!==a[o]?a[o]:""),"checkbox"===s&&(a[o]&&1===a[o]?n[i].checked=!0:n[i].checked=!1),"select"===s)for(var r=0;r<n[i].options.length;r++)if(n[i].options[r].value===a[o]){n[i].options[r].selected=!0;break}if("radio"===s){var c=n[i].querySelectorAll("input");for(r=0;r<c.length;r++)if(c[r].value===a[o]){c[r].checked=!0;break}}"range"===s&&(n[i].value=a[o]&&""!==a[o]?a[o]:10,e(o,n[i].value))}},getObject:function(t){const a=document.querySelectorAll(t);let n={};for(var i=0;i<a.length;i++){var s=a[i].dataset.action,o=a[i].dataset.key;if("text"===s&&(n[o]=a[i].value),"checkbox"===s&&(n[o]=1==a[i].checked?1:0),"select"===s&&(n[o]=a[i].options[a[i].selectedIndex].value),"radio"===s){var r=a[i].querySelector("input[name="+o+"]:checked");n[o]=r?r.value:"1"}"range"===s&&(n[o]=a[i].value,e(o,a[i].value))}return n},getAvatar:function(e,t){let a,n,i=["#184d47","#086972","#a8df65","#ffcd3c","#12cad6","#ffcd3c"];if(e&&e.length>0){var s=e.split(" ")?e.split(" "):e;a=s.length>1?s[0].charAt(0).toUpperCase()+s[1].charAt(0).toUpperCase():e.charAt(0).toUpperCase()}else a="MR";return a=a.replace(/[^A-Za-z0-9]/gi,""),'<span style="background: '+(n=i[Math.floor(Math.random()*i.length+0)])+'">'+(a||"MR")+"</span>"},mrLoader:function(e,t=!1){const a=document.querySelectorAll(".mr-spinner-full");a&&a.forEach(e=>e.remove());let n=mrAssistantObj.plugin_url+"assets/images/mr-logo.png";const i=document.createElement("DIV");i.setAttribute("class","mr-spinner-full");const s=document.createElement("IMG");s.src=n,s.width=200,i.innerHTML='<div class="mr-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>',i.prepend(s);const o=document.querySelector(e);t&&o&&("append"===t?o.prepend(i):o.innerHTML=i.innerHTML)},image:async function(e,t,a,n="bg",i=""){await new Promise(e=>{const n=new Image;n.src=t,n.onload=(()=>e(t)),n.onerror=(()=>e(a))}).then(function(a){if(a===t)return;let s=document.getElementById("mrImg-"+e);s&&("img"===n?s.innerHTML='<img width="'+i+'" src="'+a+'"/>':"imgSrc"===n?s.src=a:s.style.backgroundImage="url("+a+")")})},isset:function(e){try{return void 0!==e}catch(e){return!1}}}}(),e.prototype.translate=function(){let e="",a={};function n(){const e=document.querySelector(".mr-container");let t="";if(e){switch(e.dataset.action){case"mr-dashboard":t="dashboard";break;case"mr-chatbot-console":t="console";break;case"mr-index-table":t="indexing";break;case"mr-knowledge-base":t="knowledge";break;case"mr-chatbot-settings":t="settings";break;case"mr-chat-history":t="history";break;case"mr-user-profile":t="profile";break;default:t=""}}return t}function i(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a={};if(a.key=e.target.dataset.key,a.page=n(),a.text=e.target.innerText,a.btnText="Save",""!==a.key&&""!==a.page)return function(e){const a=document.querySelector(".mr-container"),n=document.querySelectorAll(".mrPopBox");n&&n.forEach(e=>e.remove());let i=document.createElement("DIV"),s=document.createElement("P");s.innerHTML=e.text;let o=document.createElement("TEXTAREA");o.setAttribute("type","text"),o.setAttribute("id","inputTx"),o.maxLength="5000",o.cols="30",o.rows="4",o.value=e.text;let c=document.createElement("SPAN");c.innerText=e.btnText,c.setAttribute("data-key",e.key),c.setAttribute("data-page",e.page),c.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const a=e.target.parentNode.querySelector("TEXTAREA");if(a&&a.value){let n=e.target.dataset.key,i=e.target.dataset.page,s=t.common.whiteSpaces(a.value);n&&i&&firebase.database().ref("translation").child(i).child(n).child("tx2").set(s)}const n=document.querySelectorAll(".mrPopBox");n&&n.forEach(e=>e.remove()),r()},!0),i.setAttribute("class","mrPopBox"),i.append(s),i.append(o),i.append(c),a&&a.prepend(i)}(a)}function s(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=e.target.dataset.parent,a=e.target.dataset.key,n=e.target.value,i={};a&&t&&n&&""!==n&&(i.tx2=n,firebase.database().ref("translation").child(t).child(a).update(i))}function o(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=e.target.dataset.property;const a=document.querySelector(".txBody");a.innerHTML="",t&&firebase.database().ref("translation").child(t).once("value",function(e){let n=e.val();if(n){let e=Object.keys(n);e&&a&&e.forEach(function(e){const i=document.createElement("DIV");i.setAttribute("data-property",e),i.setAttribute("class","s-row border");const o=document.createElement("LABEL");o.setAttribute("for",e),o.innerHTML=n[e].hasOwnProperty("tx1")&&""!==n[e].tx1?n[e].tx1:"...",i.append(o);const r=document.createElement("INPUT");r.setAttribute("id",e),r.setAttribute("class","mrA_input mr-main__input"),r.setAttribute("data-key",e),r.setAttribute("data-parent",t),r.value=n[e].hasOwnProperty("tx2")&&""!==n[e].tx2?n[e].tx2:"...",r.addEventListener("input",s,!0),i.append(r),a.append(i)})}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})}function r(){const t=document.querySelectorAll(".mrtx");t&&(e=n(),firebase.database().ref("translation").once("value",function(n){let s=n.val();if(s&&s.hasOwnProperty(e)){a=Object.assign({},a,s);let n=s[e];t.forEach(function(t){const a=t.innerHTML,o=t.dataset.key,r=t.dataset.mode;if(""!==o)if("menu"===r)s.hasOwnProperty("menus")&&(s.menus.hasOwnProperty(o)?t.innerText=""!==s.menus[o]?s.menus[o]:a:firebase.database().ref("translation").child("menus").child(o).set(a));else{if(n.hasOwnProperty(o)&&n[o].hasOwnProperty("tx1")&&""!==n[o].tx1)t.innerText=n[o].hasOwnProperty("tx2")&&""!==n[o].tx2?n[o].tx2:a;else{let t={tx1:a,tx2:a};firebase.database().ref("translation").child(e).child(o).update(t)}mrAssistantObj.translation&&"on"===mrAssistantObj.translation&&"page"===r&&(t.style.border="1px solid #ccc",t.addEventListener("click",i,!0))}})}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}))}return{execute:r,settingInit:function(){firebase.database().ref("translation").once("value",function(e){let t=e.val();if(t){let e=Object.keys(t);const a=document.querySelector(".txHeader");a.innerHTML="",e&&a&&e.forEach(function(e){const t=document.createElement("DIV");t.innerText=e,t.setAttribute("data-property",e),t.setAttribute("class","txRow"),t.addEventListener("click",o,!0),a.append(t)})}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})},menuTx:function(e,t,n="menus"){let i=e;return a&&a.hasOwnProperty("menus")?t&&"menu"===n&&a.hasOwnProperty(t)&&(i=""!==a[t]?a[t]:e):firebase.database().ref("translation").once("value",function(s){let o=s.val();if(o&&o.hasOwnProperty(n)){a=Object.assign({},a,o);let s=o[n];s.hasOwnProperty(t)?i=""!==s[t]?s[t]:e:firebase.database().ref("translation").child("menus").child(t).set(e)}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}),i}}}(),e.prototype.dashboard=function(){let e={};function a(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a=e.target.dataset.guid,n=e.target.dataset.action,i=e.target.dataset.uid;a&&"vChatInit"===n?firebase.database().ref("actions").child("visitorSignUp").child(a).set({guid:a,lastSync:Date.now(),status:"pending",user:"admin"}).then(function(){e.target.innerHTML=t.templateDom.loader}):i&&"chatNow"===n&&i.length>20&&(t.initializer.menuInit("mr-chatbot-console"),t.livechat_admin.chatInit(i,!0))}function n(e,n,i){var s=document.getElementById("mrVisitorsList");if(!s)return;var o=n;let r=document.getElementById("vc"+e);r&&r.remove();try{if(mrAssets.hasOwnProperty("removeVisitors")&&parseInt(mrAssets.removeVisitors)>0&&parseInt(o.lastSeen)&&t.common.timeDiff(o.lastSeen,Date.now(),"day")>mrAssets.removeVisitors)return firebase.database().ref("visitors/").child(e).remove()}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}let c=o.name;c&&c.length;var l=[`<td>${c}</td>`,`<td class="vPage">${o.currentPage}</td>`,`<td>${o.platform}</td>`,`<td>${o.browser}</td>`,`<td>${o.language}</td>`,`<td>${t.common.getDateTime(o.join)}</td>`,`<td>${t.common.timeAgo(o.lastSeen)}</td>`].join("");const d=document.createElement("TR");d.setAttribute("id","vc"+e),d.innerHTML=l;let u=document.createElement("SPAN");u.setAttribute("data-badge","visitorChat"),u.setAttribute("id","btn"+e),u.setAttribute("data-guid",o.guid),u.setAttribute("data-uid",o.uid||""),u.addEventListener("click",a,!0),o.vChat&&"initialized"===o.vChat?(u.setAttribute("class","mr_base_action vChat btn-green"),u.setAttribute("data-action","chatNow"),u.innerText="Chat Now"):(u.setAttribute("class","mr_base_action vChat"),u.setAttribute("data-action","vChatInit"),u.innerText="Try Chat");const m=document.createElement("TD");m.append(u),d.append(m),s&&("append"===i?s.append(d):s.prepend(d))}function i(){const e=document.querySelector(".mr-container");return!(!e||"mr-dashboard"!==e.dataset.action)}function s(a){if(a){let a=function(e){i()&&e.key&&e.val()&&n(e.key,e.val(),"prepend")};firebase.database().ref("visitors/").orderByChild("/lastSeen/").limitToLast(10).on("child_added",a),firebase.database().ref("visitors/").orderByChild("/lastSeen/").limitToLast(10).on("child_changed",a),function(){let t=function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let a=e,i=Object.keys(a).length;o(i,"visitors");let s,r,c=parseInt(this.parentNode.dataset.start),l=parseInt(this.parentNode.dataset.end),d=parseInt(this.parentNode.dataset.step);"prev"===this.dataset.type?(s=c-d,r=c):(s=l,r=l+d);let u=s>0?s-1:0,m=r<i?r-1:i-1;if(m<=0||s>=i)return;let p=Object.entries(a).sort((e,t)=>e[1].lastSeen&&t[1].lastSeen?t[1].lastSeen-e[1].lastSeen:0).slice(u,m);const h=document.getElementById("mrVisitorsList");h&&(h.innerHTML="");for(let e=0;p.length>e;e++)if(p[e]){let t=p[e][0];a.hasOwnProperty(t)&&n(t,a[t],"append")}const v=document.querySelector(".mrPagination");v&&(v.dataset.start=u+1,v.dataset.end=m+1,v.dataset.counter=i);const b=document.querySelector(".mrPagiStatus");b&&(b.innerHTML="( "+parseInt(u+1)+" - "+parseInt(m+1)+" ) / "+i)};firebase.database().ref("visitors/").orderByChild("/lastSeen/").once("value",function(a){let n=a.val(),i=document.getElementById("mrVisitorsList"),s=document.getElementById("mrVisitorsListHead");if(s&&(s.innerHTML='<tr class="vcHeader"><th>Name</th><th class="vPage">Current Page</th><th>Platform</th><th>Browser</th><th>Language</th><th>Join</th><th>LastSeen</th><th>Action</th></tr>'),n){e=Object.assign({},n);let a=Object.keys(n).length;if(o(a,"visitors"),a>10){const e=document.createElement("DIV");e.setAttribute("class","mrPagination"),e.setAttribute("data-start",1),e.setAttribute("data-end",11),e.setAttribute("data-counter",a),e.setAttribute("data-step",10);const n=document.createElement("DIV");n.innerText="Prev",n.setAttribute("data-type","prev"),n.addEventListener("click",t,!0);const s=document.createElement("DIV");s.setAttribute("class","mrPagiStatus"),s.innerHTML="(1 - 11) / "+a;const o=document.createElement("DIV");o.innerText="Next",o.setAttribute("data-type","next"),o.addEventListener("click",t,!0),e.append(n),e.append(s),e.append(o),i&&i.parentNode.append(e)}}else i&&(i.innerHTML="No Visitors")})}(),setTimeout(()=>t.common.mrLoader("body",!1),1500)}}function o(e,t=""){const a=document.getElementById("dash_"+t);a&&a.dataset.type===t&&(a.innerText=e)}return{execute:function(){firebase.auth().onAuthStateChanged(function(e){if(e){firebase.database().ref("actions").child("onlineVisitors").update({lastSync:Date.now(),status:"Find Visitors"}),s(e),function(){firebase.database().ref("clients").on("value",function(e){if(!i())return;let t=e.val();t&&o(Object.keys(t).length,"clients")}),firebase.database().ref("training").on("value",function(e){if(!i())return;let t=e.val();t&&o(Object.keys(t).length,"issues")}),firebase.database().ref("users").on("value",function(e){if(!i())return;let t=e.val();t&&o(Object.keys(t).length,"operators")});const e=document.getElementById("train-me");e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelectorAll(".mr-menu ul li");t&&(t.forEach(e=>e.classList.remove("menu-active")),t.forEach(function(e){"mr-knowledge-base"===e.dataset.inset&&e.click()}))},!0)}();const a=document.querySelector(".mrSync");a&&a.addEventListener("click",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),"sync"!==a.dataset.action){a.dataset.action="sync";const e=a.innerHTML;a.innerHTML=t.templateDom.loader,firebase.database().ref("actions").child("onlineVisitors").update({lastSync:Date.now(),status:"Find Visitors",unSeen:0}),setTimeout(function(t){a.dataset.action="ready",a.innerHTML=e},1e4)}},!0),t.translate.execute()}})},coreAction:a}}(),e.prototype.chat_history=function(){let e={};function a(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a=e.target.dataset.action,n=e.target.dataset.key;if(n)if("history"===a)n.length>20&&(t.initializer.menuInit("mr-chatbot-console"),t.livechat_admin.chatInit(n,!0));else if("delete"===a&&n.length>20){if(confirm("Want to delete?")){t.livechat_admin.deleteClient(n);const e=document.getElementById("cl"+n);e&&e.remove()}}}function n(e,n,i){var s=document.getElementById("mrClientsList");if(!n.info)return;var o=n.info;if(!o)return;let r=document.getElementById("cList"+e);r&&r.remove();var c=[`<td>${o.name||"Anonymous"}</td>`,`<td>${o.email||"No Email"}</td>`,`<td>${o.browser||"Unknown"}</td>`,`<td>${o.language||"Unknown"}</td>`,`<td>${t.common.getLocalTime(o.join)}</td>`,`<td>${t.common.timeAgo(o.lastSeen)}</td>`,`<td>${t.common.getTimeDiff(o.join,o.lastSeen,!0)}</td>`,`<td>${"active"===o.status?"Active":"Ended"}</td>`].join("");const l=document.createElement("TR");l.setAttribute("id","cList"+e),l.innerHTML=c;const d=document.createElement("SPAN");d.setAttribute("class","vChat btn-green"),d.innerText="History",d.setAttribute("data-action","history"),d.setAttribute("data-key",e),d.addEventListener("click",a,!0);const u=document.createElement("SPAN");u.setAttribute("class","vChat"),u.innerText="Delete",u.setAttribute("data-action","delete"),u.setAttribute("data-key",e),u.addEventListener("click",a,!0);const m=document.createElement("TD");m.append(d),m.append(u),l.append(m),"append"===i?s.append(l):s.prepend(l)}return{execute:function(){let a=function(e){if(e.key&&e.val()){const t=document.querySelector(".mr-container");t&&"mr-chat-history"===t.dataset.action&&n(e.key,e.val(),"prepend")}};firebase.database().ref("clients/").orderByChild("/info/lastSeen/").limitToLast(10).on("child_added",a),firebase.database().ref("clients/").orderByChild("/info/lastSeen/").limitToLast(10).on("child_changed",a),function(){function t(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let a,i,s=e,o=Object.keys(s).length,r=parseInt(this.parentNode.dataset.start),c=parseInt(this.parentNode.dataset.end),l=parseInt(this.parentNode.dataset.step);"prev"===this.dataset.type?(a=r-l,i=r):(a=c,i=c+l);let d=a>0?a-1:0,u=i<o?i-1:o-1;if(u<=0||a>=o)return;let m=Object.entries(s).sort((e,t)=>{if(e[1].info.lastSeen&&t[1].info.lastSeen)return t[1].info.lastSeen-e[1].info.lastSeen}).slice(d,u);const p=document.getElementById("mrClientsList");p&&(p.innerHTML="");for(let e=0;m.length>e;e++)if(m[e]){let t=m[e][0];s.hasOwnProperty(t)&&n(t,s[t],"append")}const h=document.querySelector(".mrPagination");h&&(h.dataset.start=d+1,h.dataset.end=u+1,h.dataset.counter=o);const v=document.querySelector(".mrPagiStatus");v&&(v.innerHTML="( "+parseInt(d+1)+" - "+parseInt(u+1)+" ) / "+o)}firebase.database().ref("clients/").orderByChild("/info/lastSeen/").once("value",function(a){let n=a.val(),i=document.getElementById("mrClientsList"),s=document.getElementById("mrClientsListHead");if(s&&(s.innerHTML='<tr class="vcHeader"><th>Name</th><th>Email</th><th>Browser</th><th>Language</th><th>Join</th><th>Last Seen</th><th>Chat Time</th><th>Status</th><th>Action</th></tr>'),n){e=Object.assign({},n);let a=Object.keys(n).length;if(a>2){const e=document.createElement("DIV");e.setAttribute("class","mrPagination"),e.setAttribute("data-start",1),e.setAttribute("data-end",11),e.setAttribute("data-counter",a),e.setAttribute("data-step",10);const n=document.createElement("DIV");n.innerText="Prev",n.setAttribute("data-type","prev"),n.addEventListener("click",t,!0);const s=document.createElement("DIV");s.setAttribute("class","mrPagiStatus"),s.innerHTML="(1 - 11) / "+a;const o=document.createElement("DIV");o.innerText="Next",o.setAttribute("data-type","next"),o.addEventListener("click",t,!0),e.append(n),e.append(s),e.append(o),i&&i.parentNode.append(e)}}else i&&(i.innerHTML="No Client")})}(),t.translate.execute(),t.common.mrLoader("body",!1)},coreAction:a}}(),e.prototype.livechat_admin=function(){let e,a,n,i=null,s=null,o=Date.now(),r={};function c(){return firebase.auth().currentUser.displayName||"Admin"}function l(){let e=document.getElementById("client_id");return e&&""!==e.value?e.value:""}function d(){return firebase.auth().currentUser&&firebase.auth().currentUser.uid}function u(e){const a=document.querySelector("#mr_info");a.innerHTML="";let n=function(e,t,n=""){const i=document.createElement("LI");i.innerHTML="<label>"+e+'</label><div class="'+n+'">'+t+"</div>",a.appendChild(i)};e.join&&n("Chat Time:",t.common.getTimeDiff(e.join,e.lastSeen)),e.join&&n("Join Chat:",t.common.getDateTime(e.join)),e.lastSeen&&n("Last Seen:",t.common.getDateTime(e.lastSeen)),e.currentPage&&n("Browsing:","..."+t.common.getUrlPath(e.currentPage,"path")),e.lastMessage&&n("Message:",e.lastMessage),e.method&&n("Chat Method:",e.method),e.domain&&n("Domain:",e.domain),e.status&&n("Status:",e.status),e.rate&&n("Rating:",function(e=0,t=""){let a=parseFloat(e)/5*100;return['<div class="rating_dom"><div class="rating">',`<div class="rating-upper" style="width: ${parseInt(a)}%">`,"<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>","</div>",'<div class="rating-lower">',"<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>","</div>","</div></div>",`<p>${e+("1"===e?" star":" stars")+" rating"}<p>`].join("\n")}(e.rate)),e.feedback&&n("Feedback:",e.feedback,"feedbackBox")}function m(e){if(""===(e=l()))return;let a=document.getElementById("client_id");var n=document.getElementById("cbName"),i=document.getElementById("cbEmail");b(e)&&function(e){if(""===l())return;let a=document.querySelector(".shortNoteBox");a&&(a.innerHTML="");let n=document.querySelector("#noteInput"),i=document.querySelector("#noteInputBtn");n&&i&&i.addEventListener("click",function(e){if(!b(l()))return;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a=t.common.whiteSpaces(n.value);""!==a&&(firebase.database().ref("clients").child(l()).child("info").child("notes").push({text:a,time:Date.now()}),n.value="")},!0);let s=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const a=e.target.dataset.key,n=e.target.dataset.id;"ok"===r.join?firebase.database().ref("clients").child(n).child("info").child("notes").child(a).remove().then(function(e){const t=document.getElementById("note-"+a);t&&t.remove()}):t.initializer.popMessage("You Need to Join Chat.","OK")};firebase.database().ref("clients").child(l()).child("info").child("notes").on("child_added",function(e){if(!b(l()))return;let t=e.val(),n=document.createElement("P");if(n.setAttribute("id","note-"+e.key),document.getElementById("note-"+e.key))return;const i=document.createElement("SPAN"),o=document.createElement("SPAN");o.setAttribute("class","note-btn"),o.setAttribute("data-key",e.key),o.setAttribute("data-id",l()),o.innerHTML="⤬",o.addEventListener("click",s,!0),a&&t.hasOwnProperty("text")&&(i.innerHTML=t.text,n.appendChild(i),n.appendChild(o),a.appendChild(n))})}();let s=e=>{if("ok"===r.join){var a=t.common.whiteSpaces(e.target.value),n=e.target.dataset.cid,i=e.target.id;if(n){var s=firebase.database().ref("clients").child(n).child("info");"cbName"===i&&a&&(s.child("name").set(a),document.getElementById("cb-client-name").innerText=a),"cbEmail"===i&&a&&s.child("email").set(a)}}else t.initializer.popMessage("You Need to Join chat.","OK")};firebase.database().ref("clients").child(l()).child("info").on("value",function(t){if(b(e)&&a.value===e){var o=t.val();let a=o.name&&""!==o.name?o.name:"Anonymous";document.getElementById("cb-client-name").innerText=a,n.value=a,n.setAttribute("data-cid",e),n.addEventListener("keyup",s),i.value=o.email&&""!==o.email?o.email:"",i.setAttribute("data-cid",l()),i.addEventListener("keyup",s),u(o)}})}function p(e,a="",n=!1){let i={name:c(),uid:d(),text:e,type:a||"admin",time:Date.now()};return n&&(i.avatar=t.template.getAvatar(i.uid)),firebase.database().ref("livechat").child(l()).push(i).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})}function h(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a=null;document.getElementById("mr_admin_send_btn").dataset.clientId;if("ok"===r.join){const e=document.getElementById("mr_admin_send");var n=t.common.whiteSpaces(e.value);a&&clearTimeout(a),e.value="",a=setTimeout(function(){""!==n&&(async()=>p(n,"admin"))()},10)}else t.initializer.popMessage("You Need to Join chat.","OK")}function v(a,n){if(""===(a=l()))return;let i=firebase.database().ref("clients").child(a);document.querySelector("#start_chat"),document.getElementById("mr_admin_send_btn"),document.getElementById("mr_admin_send");let s=d();s&&i.child("conversation").child(s).on("value",function(n){const i=document.querySelector("#start_chat");let o=n.val();o&&"active"===o.status?(i.dataset.type="leave",i.innerText="Leave",i.classList.add("mr-off"),r=Object.assign({},{join:"ok",clintId:a,admin:s})):(i.dataset.type="join",i.innerText="Join Chat",i.classList.remove("mr-off"),r=Object.assign({},{join:"not",clintId:a,admin:s})),function(e,a,n){if(""===(e=l()))return;const i=document.getElementById("mr_admin_send_btn"),s=document.getElementById("mr_admin_send");if("join"===n){if(s){let e=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),13!==("which"in e?e.which:e.keyCode)&&"Enter"!==e.key||i&&i.click()};s.removeEventListener("keyup",e,!0),s.addEventListener("keyup",e,!0)}i&&(i.dataset.clientId=e,i.removeEventListener("click",h,!0),i.addEventListener("click",h,!0))}else if("leave"===n&&i){i.removeEventListener("click",h,!0);let e=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.initializer.popMessage("You Need To Join Chat.")};i.removeEventListener("click",e,!0),i.addEventListener("click",e,!0)}}(a,0,"join"),i.style.display="block",i.dataset.uid=s,e&&clearTimeout(e),e=setTimeout(function(){!function(e){if(""===(e=l()))return;const t=document.querySelector("#start_chat"),a=document.querySelector("#chat_menu");if(t.dataset.chat=e,t.style.display="block",t){let a=function(a){if(""===(e=l()))return;a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),t.dataset.chat;let n=t.dataset.type;""!==d()&&firebase.database().ref("users").child(d()).once("value",function(t){let a=t.val();if(a&&a.access){let t={name:a.name||"Admin",type:"person",avatar:a.hasOwnProperty("avatar")?a.avatar:""};"join"===n?(t.join=Date.now(),t.status="active",mrAssistantObj.hasOwnProperty("joinChat")&&""!==mrAssistantObj.joinChat&&p(mrAssistantObj.joinChat.replace("{operatorName}",c()),"admin",!0),r=Object.assign({},{join:"ok"}),firebase.database().ref("clients").child(e).child("info").child("type").once("value",function(t){let a=t.val();a&&"archive"===a||firebase.database().ref("clients").child(e).child("info").child("type").set("liveChat")})):(t.ended=Date.now(),t.status="ended",p(c()+" has left the chat.","admin",!0),r=Object.assign({},{join:"not"})),firebase.database().ref("clients").child(e).child("conversation").child(d()).update(t)}})};t.addEventListener("click",a,!0)}if(a){a.classList.remove("mr-hide");const e=document.querySelector("#mr-more-action");e&&(e.classList.remove("mr-hide"),a.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),"close"===e.dataset.type?(e.style.display="block",e.dataset.type="open"):(e.style.display="none",e.dataset.type="close")},!0))}}(a)},100)})}function b(e){if(""===e)return;const t=document.getElementById("client_id");if(t){const a=t.value;if(Date.now()-o>6e4&&(o=Date.now(),firebase.database().ref("actions").child("onlineVisitors").update({lastSync:Date.now(),status:"Chat Console"})),a===e)return!0}return!1}function f(e,n=!1){e&&(a&&clearTimeout(a),a=setTimeout(function(){let a=document.getElementById("client_id");const o=document.getElementById("admin-messages");var c=document.querySelectorAll("#mrClientsList li");c&&c.forEach(e=>e.classList.remove("chat-active"));let d=document.getElementById("mr-"+e);d&&d.classList.add("chat-active"),r=Object.assign({},{join:"not",clintId:e}),o.innerHTML="",a.value=e,firebase.database().ref("clients").child(e).once("value",function(a){let n=a.val();n&&(function(e){if(""===(e=l()))return;firebase.database().ref("clients").child(e).child("settings").on("value",function(a){if(!b(e))return;document.querySelectorAll(".mr_menu_item");let n=a.val();const i=document.getElementById("mr-more-action");if(i&&(i.innerHTML="",n)){let a=function(a){if(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),"ok"===r.join){var n=a.target.dataset.type,i=a.target.dataset.action;let t={};t[n]=i;let s={actionType:i,status:"pending",time:Date.now()};"status"===n?(s.actionName="botStatus",firebase.database().ref("clients").child(e).child("actions").push(s)):"uEndChat"===n?(s.actionName="endChat",firebase.database().ref("clients").child(e).child("actions").push(s)):firebase.database().ref("clients").child(e).child("settings").update(t)}else t.initializer.popMessage("You Need to Join chat.","OK")},s=function(e,t){let n={on:"off",off:"on",block:"unblock",unblock:"block",archive:"unarchived",unarchived:"archive",start:"end",end:"start",pulse:"active",active:"pulse"},s=document.createElement("LI"),o=document.createElement("LABEL");o.innerHTML={mrSupport:"Mr Assistant",kbSupport:"Knowledge Base",block:"Block User",archive:"Archive Chat",uEndChat:"End Chat",status:"Bot Status"}[e];let r=document.createElement("SPAN");r.addEventListener("click",a,!0),r.setAttribute("class","mr_menu_item mr-off2 "+n[t]),r.setAttribute("data-type",e),r.setAttribute("data-action",n[t]),r.innerHTML=n[t],s.appendChild(o),s.appendChild(r),i.appendChild(s)};Object.keys(n).forEach(function(e){if(n.hasOwnProperty(e)){let t=n[e];document.createElement("LI"),s(e,t)}})}})}(e=l()),function(e){if(""===l())return;const a=document.querySelectorAll(".mr_action_btn");a&&a.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a={},n=e.target.dataset.type,i=e.target.dataset.action;if("search"===n){let e=document.getElementById("redirect_input"),n=document.querySelector('input[name="chatConsoleAction"]:checked');if(!n)return t.initializer.popMessage("You Need to choose an Action","OK");{let t=n.value;if(""===e.value)return;i=e.value,a.actionName=i,a.subAction=t,e.value=""}}""!==n&&""!==i&&(a.actionType=n,a.actionName=i,a.time=Date.now(),a.status="pending","ok"===r.join?firebase.database().ref("clients").child(l()).child("actions").push(a):t.initializer.popMessage("You Need to Join chat.","OK"))},!0)}),firebase.database().ref("clients").child(l()).child("actions").on("value",function(e){if(!b(l()))return;let a=e.val();const n=document.querySelectorAll(".mr_action_table");n&&n.forEach(function(e){let n=e.dataset.type;if(!n)return;const i=document.createElement("TR");if(e.innerHTML="",i.innerHTML="<td>Time</td><td>Action</td><td>status</td>",e.appendChild(i),a&&Object.entries(a).length>0)for(let i in a){if(!a.hasOwnProperty(i))continue;let s=a[i];s.hasOwnProperty("actionType")&&(s.actionType===n&&function(a){const n=document.createElement("TR");n.innerHTML="<td>"+t.common.time(a.time)+"</td><td>"+a.actionName+"</td><td>"+a.status+"</td>",e.appendChild(n)}(s),"allActions"===n&&function(a){const n=document.createElement("TR");n.innerHTML="<td>"+t.common.time(a.time)+"</td><td>"+a.actionName+"</td><td>"+a.status+"</td>",e.appendChild(n)}(s))}else e.innerHTML=""})});const n=document.querySelector(".allActionsBtn");n&&n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelectorAll(".mr-info-boxes");t&&t.forEach(e=>{let t=e.dataset.action;"chatInfo"===t&&e.classList.add("mr-hide"),"chatAction"===t&&e.classList.add("mr-hide"),"allActionsView"===t&&e.classList.remove("mr-hide")})},!0)}(),function(e){const t=document.querySelectorAll(".mr-chat-info-menu h2");t&&t.forEach(function(e){e.addEventListener("click",function(a){let n=e.dataset.action;t.forEach(e=>e.classList.remove("menu-active")),e.classList.add("menu-active");const i=document.querySelectorAll(".mr-info-boxes");i&&i.forEach(e=>{let t=e.dataset.action;n===t?e.classList.remove("mr-hide"):e.classList.add("mr-hide");const a=document.querySelector(".allActionsView");a&&a.classList.add("mr-hide")})})})}(),v(e),m(e),function(e,a){if(""===(e=l()))return;const n=document.getElementById("cb-clint-browsing");let i=document.getElementById("client_id");n.innerHTML="",firebase.database().ref("browses").child(e).limitToLast(20).on("child_added",function(a){if(!b(e))return;let s="bh"+a.key;if(!document.getElementById(s)&&i.value===e){let e=a.val(),i=t.common.time(e.time)+" - "+(e.page.length>35?e.page.substring(0,35)+"..":e.page),o=document.createElement("LI");o.setAttribute("class","lr"),o.setAttribute("id",s),o.innerHTML=i,n.prepend(o),n.scrollIntoView({behavior:"smooth",block:"end"})}})}(e),function(e,a){if(""===(e=l()))return;const n=document.getElementById("cb-clint-error");let i=document.getElementById("client_id");n.innerHTML="",firebase.database().ref("training").orderByChild("uid").equalTo(e).limitToLast(20).on("child_added",function(a){if(!b(e))return;let s="ti"+a.key;if(!document.getElementById(s)&&i.value===e){let e=a.val(),i=t.common.time(e.time)+" - "+(e.qs.length>35?e.qs.substring(0,35)+"..":e.qs),o=document.createElement("LI");o.setAttribute("class","lr"),o.setAttribute("id",s),o.innerHTML=i,n.prepend(o),n.scrollIntoView({behavior:"smooth",block:"end"})}})}(e))}).then(function(){t.common.mrLoader(!0),firebase.database().ref("livechat").child(e).limitToLast(20).on("child_added",function(a){var n=a.val();b(e)&&t.template.templateDark(a.key,n,"message-visitor",e)}),t.common.mrLoader(!1),firebase.database().ref("clients").child(e).child("info").child("unread").set("")}).then(function(){if(n){var a=document.querySelectorAll("#mrClientsList li");a&&a.forEach(e=>e.classList.remove("chat-active"));let t=document.getElementById("mr-"+e);t&&t.classList.add("chat-active")}i&&clearTimeout(i),i=setTimeout(function(){!function(e){s&&clearTimeout(s);s=setTimeout(function(){e=l();let a=document.getElementById("admin-messages");if(!a||""===e)return;let n=a.parentNode;n&&n.prepend(t.common.loader("on"));let i=document.querySelectorAll(".loadMoreMessages");return i&&i.forEach(e=>e.remove()),firebase.database().ref("livechat/").child(e).once("value",function(i){let s=i.val();if(!s)return t.common.loader("off");let o=Object.keys(s).length||0;if(a&&o>20){const a=document.createElement("DIV");if(a.setAttribute("class","loadMoreMessages"),a.setAttribute("data-inset",20),a.setAttribute("data-step",20),a.setAttribute("data-counter",o),a.setAttribute("style","display:block"),a.setAttribute("id",e),a.innerHTML="Load More ↻",a.addEventListener("click",g,!0),e===l()){let e=document.querySelectorAll(".loadMoreMessages");e&&e.forEach(e=>e.remove()),n.prepend(a),t.common.loader("off")}}else t.common.loader("off")})},100)}(e)},100)}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})},100))}function y(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),f(e.target.dataset.chat?e.target.dataset.chat:e.target.offsetParent.dataset.chat)}function g(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const a=document.getElementById("client_id").value;let n=document.getElementById("admin-messages");if(!n||""===a)return;let i=n.parentNode;i&&i.prepend(t.common.loader("on")),firebase.database().ref("livechat").child(a).once("value",function(e){let n=e.val();if(!n)return t.common.loader("off");let i=Object.entries(n),s=i.length||0,o=document.querySelector(".loadMoreMessages"),r=parseInt(o.dataset.step),c=parseInt(o.dataset.inset),l=(parseInt(o.dataset.counter),c+r),d=s-c,u=d-r>0?d-r:0,m=i.slice(u,d);for(let e=m.length;e>=0;e--)if(m[e]){let i=m[e][0];n.hasOwnProperty(i)&&t.template.templateDark(i,n[i],"prepend",a)}o.dataset.inset=l,o.style.display=s>l?"block":"none",t.common.loader("off")})}function A(e){firebase.database().ref("clients/").child(e).remove(),firebase.database().ref("browses/").child(e).remove(),firebase.database().ref("livechat/").child(e).remove(),firebase.database().ref("training/").child(e).remove()}function _(e,a,n){var i=document.getElementById("mrClientsList"),s=["cb-row"];if(e&&i){let l=a;var o=document.getElementById("mr-"+e);o&&o.classList.contains("chat-active")&&s.push("chat-active");document.getElementById("mr-"+e);try{if(mrAssets.hasOwnProperty("removeChatHistory")&&parseInt(mrAssets.removeChatHistory)>0&&parseInt(l.info.lastSeen)&&t.common.timeDiff(l.info.lastSeen,Date.now(),"day")>parseInt(mrAssets.removeChatHistory))return A(e)}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}if(a){var r=document.createElement("li"),c=l.info.type;if(l.settings&&"archive"==l.settings.archive?(s.push("archive"),s.push("hide")):"visitorChat"===c?(s.push("visitor"),s.push("hide")):s.push("chatting"),l.settings){let e=l.settings;"block"===e.block?s.push("p0"):"pulse"===e.status&&s.push("p1")}r.setAttribute("class",s.join(" ")),r.setAttribute("data-chat",e),r.addEventListener("click",y,!0),r.setAttribute("id","mr-"+e);let a=l.info.name,d=a&&a.length>0?a:"Anonymous",u=l.info.lastMessage,m=u&&u.length>0?u:"",p=parseInt(l.info.unread),h=p>99?"99":p,v=p&&p>0?'<sup class="unRead">'+h+"</sup>":"",b=()=>{let e=parseInt(l.info.lastSeen);if(e<1||e>Date.now())return"offline";let t=Math.abs(Date.now()-e);return t?3e5>t?"online":36e5>t?"away":"offline":"offline"},f='<sub class="onlineDot '+b()+'">&nbsp;</sub>';if(r.innerHTML=['<div class="mr-avatar-img">',t.common.getAvatar(l.info.name||"MR.",30),v,f,"</div>",'<div class="mr-avatar-name">','<div class="name">'+d+"</div>",'<div class="time" data-time="'+l.info.lastSeen+'">'+t.common.timeAgo(parseInt(l.info.lastSeen))+"</div>",'<div class="status"><span class="dot '+b()+'"></span> '+b()+"</div>",'<div class="preview">'+m+"</div>","</div>"].join("\n"),o){let e=o.querySelector(".time");if(e){e.dataset.time==l.info.lastSeen?(o.className=s.join(" "),o.innerHTML=r.innerHTML):(o.remove(),"append"===n?i.append(r):i.prepend(r))}}else"append"===n?i.append(r):i.prepend(r)}}}function w(e){if(e){const e=document.querySelectorAll(".mr-chat-menu h2");firebase.database().ref("clients/").orderByChild("/info/lastSeen/").limitToLast(20).on("child_added",function(e){let t=e.val();const a=document.querySelector(".mr-container");a&&"mr-chatbot-console"===a.dataset.action&&t&&_(e.key,t,"prepend")}),firebase.database().ref("clients/").on("child_changed",function(e){let t=e.val();const a=document.querySelector(".mr-container");a&&"mr-chatbot-console"===a.dataset.action&&t&&_(e.key,t,"prepend")}),firebase.database().ref("clients/").orderByChild("/info/lastSeen/").once("value",function(e){let t=e.val();if(!t)return;let a=Object.keys(t).length;if(a>20){let e=document.querySelector(".loadMore");if(e){let t=parseInt(e.dataset.inset);e.style.display=a>t?"block":"none",e.dataset.counter=a,e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let n=parseInt(e.dataset.inset),i=(parseInt(e.dataset.counter),n+20);firebase.database().ref("clients/").orderByChild("/info/lastSeen/").once("value",function(e){let t=e.val(),a=Object.entries(t).sort((e,t)=>{if(e[1].info.lastSeen&&t[1].info.lastSeen)return t[1].info.lastSeen-e[1].info.lastSeen}),i=n-1;const s=a.slice(i,i+20);for(let e=0;s.length>e;e++)if(s[e]){let a=s[e][0];t.hasOwnProperty(a)&&_(a,t[a],"append")}}),e.dataset.inset=i,e.style.display=a>i?"block":"none"},!0)}}}),e&&e.forEach(function(t){t.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),e.forEach(e=>e.classList.remove("menu-active")),t.classList.add("menu-active");const n=document.querySelectorAll("#mrClientsList li");if(n){let e=t.dataset.action;n.forEach(function(t){t.classList.add("hide"),"archiveChat"===e?t.classList.contains("archive")&&t.classList.remove("hide"):"visitorsChat"===e?t.classList.contains("visitor")&&t.classList.remove("hide"):"liveChat"===e&&t.classList.contains("chatting")&&t.classList.remove("hide")})}})});const t=document.querySelectorAll(".mr-chat-menu2 h2");t&&t.forEach(e=>{e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let a=e.dataset.action,n=document.getElementById("mrClientsList");if(n)if("listView"===a)n.classList.remove("grid"),n.classList.add("list");else if("gridView"===a)n.classList.remove("list"),n.classList.add("grid");else if("sort"===a){"asc"===e.dataset.sort?(e.dataset.sort="desc",n.classList.add("asc")):(e.dataset.sort="asc",n.classList.remove("asc"))}},!0)})}setTimeout(()=>t.common.mrLoader("body",!1),1500)}return{execute:function(){firebase.auth().onAuthStateChanged(function(e){n=Object.assign({},n,mrAssets||{}),w(e||null),function(){const e=document.querySelectorAll(".mClientMenu");e&&e.forEach(function(e){e.addEventListener("click",function(t){event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation();let a=e.dataset.type;const n=document.querySelector(".left"),i=document.querySelector(".cb-info");i&&n&&("clients"===a?(n.style.display="block"===n.style.display?"none":"block",i.style.display="none"):"info"===a&&(i.style.display="block"===i.style.display?"none":"block",n.style.display="none"))},!0)})}()}),t.translate.execute(),setTimeout(()=>t.common.mrLoader("body",!1),1500)},chatInit:f,deleteClient:A}}(),e.prototype.userProfile=function(){let e={};function a(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=e.target.dataset.key;"block"===e.target.dataset.action&&confirm("Are you Sure?")&&""!==t&&firebase.database().ref("users/").child(t).once("value",function(e){let a=e.val();if(a&&a.hasOwnProperty("access")){let e=a.access;firebase.database().ref("users/").child(t).update({access:!e})}})}function n(e,n,i){var s=document.getElementById("mrUsersList"),o=n;let r=document.getElementById("us"+e);r&&r.remove();let c=o.access?"Block User":"Unblock User";var l=document.createElement("TR");l.setAttribute("id","us"+e),l.innerHTML=(e=>["<td>"+o.name+"</td>","<td>"+o.email+"</td>","<td>"+t.common.getLocalTime(o.creationTime)+"</td>","<td>"+t.common.timeAgo(o.lastSignInTime)+"</td>"].join(""))();const d=document.createElement("SPAN");d.setAttribute("class","vChat btn-green"),d.innerText=c,d.setAttribute("data-action","block"),d.setAttribute("data-key",e),d.addEventListener("click",a,!0);const u=document.createElement("TD");u.append(d),l.append(u),"append"===i?s.append(l):s.prepend(l)}return{execute:function(){firebase.auth().onAuthStateChanged(function(a){if(a){!function(e){const a=document.getElementById("mrUpdatePhotoUrl"),n=document.getElementById("mrUpdateDisplayName"),i=document.getElementById("mrUpdateUserEmail"),s=document.getElementById("mr_update_user_profile");document.getElementById("mr_update_user_pass"),e&&e.uid&&firebase.database().ref("users").child(e.uid).once("value",function(t){let s=t.val();s&&(a&&(a.value=s.avatar||""),n&&(n.value=s.name||""),i&&(i.value=e.email||""))}).then(function(){s&&s.addEventListener("click",function(i){i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),e.updateProfile({displayName:n.value,photoURL:""!==a.value?a.value:" "}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}),firebase.database().ref().child("users").child(e.uid).update({name:n.value,avatar:a.value}).then(function(){t.initializer.addUserToScript()})},!0)}),t.common.mrLoader("body",!1)}(a);let i=function(e){const t=document.querySelector(".mr-container");t&&"mr-user-profile"===t.dataset.action&&e.key&&e.val()&&n(e.key,e.val(),"prepend")};firebase.database().ref("users/").orderByChild("/lastSignInTime/").limitToLast(10).on("child_added",i),firebase.database().ref("users/").orderByChild("/lastSignInTime/").limitToLast(10).on("child_changed",i),function(){function t(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let a,i,s=e,o=Object.keys(s).length,r=parseInt(this.parentNode.dataset.start),c=parseInt(this.parentNode.dataset.end),l=parseInt(this.parentNode.dataset.step);"prev"===this.dataset.type?(a=r-l,i=r):(a=c,i=c+l);let d=a>0?a-1:0,u=i<o?i-1:o-1;if(u<=0||a>=o)return;let m=Object.entries(s).sort((e,t)=>{if(e[1].lastSignInTime&&t[1].lastSignInTime)return t[1].lastSignInTime-e[1].lastSignInTime}).slice(d,u);const p=document.getElementById("mrUsersList");p&&(p.innerHTML="");for(let e=0;m.length>e;e++)if(m[e]){let t=m[e][0];s.hasOwnProperty(t)&&n(t,s[t],"append")}const h=document.querySelector(".mrPagination");h&&(h.dataset.start=d+1,h.dataset.end=u+1,h.dataset.counter=o);const v=document.querySelector(".mrPagiStatus");v&&(v.innerHTML="( "+parseInt(d+1)+" - "+parseInt(u+1)+" ) / "+o)}firebase.database().ref("users/").orderByChild("/lastSignInTime/").once("value",function(a){let n=a.val(),i=document.getElementById("mrUsersList"),s=document.getElementById("mrUsersListHead");if(s&&(s.innerHTML='<tr class="vcHeader"><th>Name</th><th>Email</th><th>Creation Time</th><th>Last SignIn</th><th>Action</th></tr>'),n){e=Object.assign({},n);let a=Object.keys(n).length;if(a>2){const e=document.createElement("DIV");e.setAttribute("class","mrPagination"),e.setAttribute("data-start",1),e.setAttribute("data-end",11),e.setAttribute("data-counter",a),e.setAttribute("data-step",10);const n=document.createElement("DIV");n.innerText="Prev",n.setAttribute("data-type","prev"),n.addEventListener("click",t,!0);const s=document.createElement("DIV");s.setAttribute("class","mrPagiStatus"),s.innerHTML="(1 - 11) / "+a;const o=document.createElement("DIV");o.innerText="Next",o.setAttribute("data-type","next"),o.addEventListener("click",t,!0),e.append(n),e.append(s),e.append(o),i&&i.parentNode.append(e)}}else i&&(i.innerHTML="No Client")})}(),t.translate.execute()}})},coreAction:a}}(),e.prototype.templateDom=function(){function e(e="",t="",a="page"){return'<span class="mrtx" data-key="'+t+'" data-mode="'+a+'">'+e+"</span>"}return{execute:function(t){return"mr-dashboard"===t?['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header"><h2 id="cb-title"><span class="iconify" data-icon="fa-solid:home"></span> '+e("Dashboard","_txd1")+"</h2></div>",'<div class="mr-main__content"><div class="mr-main__settings-form">','<div class="mr-dash-box"><h2 class="dash-title1"><span class="iconify" data-icon="ant-design:user-switch-outlined"></span> '+e("Visitors on your page right now","_txd2")+"</h2>","<p>"+e("Start a conversation with your visitors and turn them into happy customers.","_txd3")+"</p>",'<span class="iconify visitor-img" data-icon="whh:visitor"></span></div>','<div id="cbAppearance" class="cb-setting active">','<section class="mr-setting-block"><div class="table-title header-both">','<h2 class="">'+e("Visitors List","_txd4")+"</h2>",'<div class="mrSync"><span class="iconify" data-icon="fa-solid:sync-alt"></span> Sync</div></div>','<table class="mrTable"><thead id="mrVisitorsListHead"></thead><tbody id="mrVisitorsList"></tbody></table>','<div class="scrollbar"><ul id="mrVisitorsList" class="list-reverse people visitors "></ul></div>',"</section></div>",'<div class="mr-dash-news"><h2 class="dash-title">'+e("Mr. Assistant Overview","_txd50")+"</h2>",'<div class="mr-dash-docs"><div class="train-box"><h1 id="dash_visitors" data-type="visitors">0</h1>',"<h2><strong>"+e("Total Visitors","_txd61")+"</strong></h2>","</div>",'<div class="train-box"><h1 id="dash_clients" data-type="clients">0</h1>',"<h2><strong>"+e("Total Clients","_txd71")+"</strong></h2>","</div>",'<div class="train-box"><h1 id="dash_issues" data-type="issues">0</h1>',"<h2><strong>"+e("Training Issues","_txd81")+"</strong></h2>",'<div id="train-me" class="train-btn"><span class="iconify" data-icon="mdi:robot-industrial"></span> Train Now',"</div></div>",'<div class="train-box"><h1 id="dash_operators" data-type="operators">0</h1>',"<h2><strong>"+e("Total Live Operators","_txd91")+"</strong></h2>",'<div class="train-btn theme">+ 1 Mr. Assistant</div>',"</div></div></div></div></div></div></div>"].join(""):"mr-chatbot-console"===t?['<div class="aicb-setting mr-chat-console wrapper" data-action="mr-chatbot-console">','<div class="container">','<div class="left">','<div class="cb-row mr-chat-menu">','<h2 data-action="liveChat"><span class="iconify" data-icon="bx:bxs-chat"></span><span>'+e("Chats","_txc1")+"</span></h2>",'<h2 data-action="visitorsChat"><span class="iconify" data-icon="whh:visitor" data-inline="true"></span><span>'+e("Visitors","_txc2")+"</span></h2>",'<h2 data-action="archiveChat"><span class="iconify" data-icon="feather:archive" data-inline="false"></span><span>'+e("Archive","_txc3")+"</span></h2>","</div>",'<div class="scrollbar2">','<ul id="mrClientsList" class="list-reverse people visitors "></ul>',"</div>",'<div class="loadMore loadMoreClients" data-action="loadMore" data-inset="20">'+e("Load More","_txc4")+" <span>&#8635;</span></div>",'<div class="cb-row mr-chat-menu2">','<h2 data-action="gridView"><span class="iconify" data-icon="simple-line-icons:grid"></span><span> Grid View</span></h2>','<h2 data-action="listView"><span class="iconify" data-icon="fa-solid:th-list"></span><span> List View</span></h2>','<h2 data-action="sort" data-sort="asc"><span class="iconify" data-icon="whh:sortbysizeascending"></span></span><span> Sort</span></h2>',"</div>","</div>",'<div class="right">','<div class="cb-row padding-15">','<div class="mClientMenu" data-type="clients"><span class="iconify" data-icon="ant-design:menu-unfold-outlined"></span></div>','<div class="flex-grow cb-to"><span id="cb-client-name">'+e("Mr. Visitor","_txc8")+"</span>","</div>",'<div id="chat-action" class="flex-grow header-right">','<span id="start_chat" class="btn">'+e("Start Chat","_txc9")+"</span>",'<span id="chat_menu" class="iconify mr-hide" data-icon="mdi-light:chevron-down"></span>',"</div>",'<ul id="mr-more-action" class="mr-popup" data-type="close" style="display: none;"></ul>','<div class="mClientMenu mClientMenuInfo" data-type="info"><span class="iconify" data-icon="ant-design:menu-fold-outlined"></span></div>',"</div>",'<div class="scrollbar cb-message-box">','<div class="loadMoreMessages">Load More <span>↻</span></div>','<div id="admin-messages" class="messages">','<div class="message-box"><p>'+e("No Chat Selected","_txc10")+"</p></div>","</div>","</div>",'<div class="cb-message-input">','<div id="admin-message-form" class="cb-row cb-form theme">','<input type="hidden" id="client_id" value="">','<textarea id="mr_admin_send" class="cb-input cb-input-box" type="text" placeholder="Write Your Message here..."></textarea>','<button id="mr_admin_send_btn" type="submit" class="cb-input cb-input-btn"><span class="iconify" data-icon="zmdi:mail-send"></span></button>',"</div>","</div>","</div>",'<div class="cb-info">','<div class="cb-row mr-chat-info-menu">','<h2 data-action="chatInfo"><span class="iconify" data-icon="whh:details"></span><span>'+e("Chat Info","_txc11")+"</span></h2>",'<h2 data-action="chatAction"><span class="iconify" data-icon="ant-design:interaction-outlined"></span><span>'+e("Chat Actions","_txc12")+"</span></h2>","</div>",'<div class="scrollbar3 mr-info-boxes" data-action="chatInfo">','<div class="cb-panel cb-clint-info2 bg-light2">','<h4 class="cb-panel-head"><span class="iconify" data-icon="mdi:account-card-details-outline"></span> Details</h4>','<ul class="mr-info-box cb-light-box cb-panel-body cb-browses">','<li id="test"><label for="cbName">'+e("Name:","_txc13")+' </label><input type="text" class="cbPanelInput" id="cbName"></li>','<li><label for="cbEmail">'+e("Email:","_txc14")+' </label><input type="email" class="cbPanelInput" id="cbEmail"><br></li>','<li><label for="cbJoin">'+e("Notes:","_txc15")+" </label>",'<div class="shortNote"><div class="shortNoteBox"></div>','<div class="shortNoteInput"><input type="text" class="cbPanelInput" id="noteInput"><span id="noteInputBtn">'+e("Add","_txc16")+"</span></div>","</div>","</li>","</ul>","</div>",'<div class="cb-panel">','<h4 class="cb-panel-head"><span class="iconify" data-icon="whh:detailsalt"></span> '+e("Chat Info","_txc17")+"</h4>",'<ul id="mr_info" class="cb-light-box"></ul>',"</div>",'<div class="cb-panel">','<h4 class="cb-panel-head"><span class="iconify" data-icon="oi:browser"></span> '+e("Visited Pages","_txc18")+"</h4>",'<ul id="cb-clint-browsing" class="cb-panel-body"></ul>',"</div>",'<div class="cb-panel">','<h4 class="cb-panel-head"><span class="iconify" data-icon="bpmn:end-event-error"></span> '+e("Training Issues","_txc19")+"</h4>",'<ul id="cb-clint-error" class="cb-panel-body"></ul>',"</div>","</div>",'<div class="scrollbar mr-info-boxes mr-hide" data-action="chatAction">','<div id="survey_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+e("Send Survey Form","_txc20")+"</h4>","<p>"+e("Ask Anonymous visitors about his/her Name and Email Address","_txc21")+"</p>",'<table class="mr_action_table mr-table" data-type="survey"></table>','<button class="mr_action_btn btn btn-green" data-type="survey" data-action="signUp">Execute Action</button>',"</div>",'<div class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="fa-solid:search-dollar" data-inline="true"></span>'+e("Searching Actions","_txc23")+"</h4>","<p>"+e("Suggest your client, another predefined knowledge base or page","_txc24")+"</p>",'<table class="mr_action_table mr-table" data-type="search"></table>','<div class="mrTheme chatConsoleAction">','<label for="theme2"><input type="radio" name="chatConsoleAction" id="theme2" value="kb"><p style="background: #cd8d7b">KB Action</p></label>','<label for="theme3"><input type="radio" name="chatConsoleAction" id="theme3" value="redirect"><p style="background: #687466">Open Page</p></label>',"</div>",'<input type="text" id="redirect_input" placeholder="Add Action here"/>','<button class="mr_action_btn btn btn-green" data-type="search" data-action="searchAction">Execute Action</button>',"</div>",'<div id="help_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+e("Help Action","_txc26")+"</h4>","<p>"+e("Open Help menu in user facing chat widget.","_txc27")+"</p>",'<table class="mr_action_table mr-table" data-type="help"></table>','<button class="mr_action_btn btn btn-green" data-type="help" data-action="HelpMenu">Execute Action</button>',"</div>",'<div id="feedback_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+e("Send Feedback Form","_txc29")+"</h4>","<p>"+e("Ask your visitors about feedback and rating of chat","_txc31")+"</p>",'<table class="mr_action_table mr-table" data-type="feedback"></table>','<button class="mr_action_btn btn btn-green" data-type="feedback" data-action="Feedback">Execute Action</button>',"</div>",'<div id="feedback_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="bx:bxs-food-menu" data-inline="true"></span> '+e("Open Menu Action","_txc33")+"</h4>","<p>"+e("Open Menu in User Chat Widget","_txc34")+"</p>",'<table class="mr_action_table mr-table" data-type="menuAction"></table>','<button class="mr_action_btn btn btn-green" data-type="menuAction" data-action="menuAction">Execute Action</button>',"</div>","</div>",'<div class="scrollbar mr-info-boxes mr-hide allActionsView" data-action="allActionsView">','<div id="all_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+e("All Actions","_txc38")+"</h4>",'<table class="mr_action_table mr-table mr-all-action-table" data-type="allActions"></table>',"</div>","</div>",'<div class="cb-row mr-chat-menu4">','<h2 class="allActionsBtn"><span class="iconify" data-icon="uil:transaction"></span><span>'+e("All Actions Status","_txc39")+"</span></h2>","</div>","</div>","</div>","</div>"].join(""):"mr-chatbot-settings"===t?function(){const t=['<div class="aicb-setting" data-action="mr-chatbot-manager">','<ul id="cb-settings-actions" class="mr-sidebar mr-shadow">','<div class="mr-sidebar__header"><p><span class="iconify" data-icon="dashicons:admin-settings"></span> '+e("Settings and Configuration","_txs1")+"</p></div>",'<li class="mr-sidebar__menu-item sidebar__menu-item--active" data-id="#cbBotConfig"><span class="iconify" data-icon="simple-icons:dependabot"></span> '+e("General Configuration","_txs2")+"</li>",'<li class="mr-sidebar__menu-item" data-id="#cbChatWithVisitors"><span class="iconify" data-icon="raphael:anonymous"></span> '+e("Chat With Visitors","_txs3")+"</li>",'<li class="mr-sidebar__menu-item" data-id="#cbSearchEngine"><span class="iconify" data-icon="simple-icons:dependabot"></span> '+e("Mr. Assistant Bot","_txs11")+"</li>",'<li class="mr-sidebar__menu-item" data-id="#cbMenus"><span class="iconify" data-icon="gridicons:menus"></span> '+e("Custom Menus","_txs7")+"</li>",'<li class="mr-sidebar__menu-item" data-id="#cbTranslation"><span class="iconify" data-icon="dashicons:translation"></span> '+e("Translation","_txs10")+"</li>",'<li class="mr-sidebar__menu-item" data-id="#cbHelp"><span class="iconify" data-icon="mdi-light:help-circle"></span> '+e("Help Menu","_txs8")+"</li>","</ul>",'<div class="mr-main mr-shadow">','<div class="mr-main__header mSettingsHeader">','<div class="mSettingsMenu"><span class="iconify" data-icon="ant-design:menu-unfold-outlined"></span></div>','<h2 id="cb-title"><span class="iconify" data-icon="ant-design:setting-filled"></span> Settings</h2>',"</div>",'<div class="mr-main__content">','<div class="mr-main__settings-form">'].join(""),a=['<div id="cbBotConfig" class="cb-setting active">','<section class="mr-setting-block">','<div class="s-row border">','<label for="mr-switch-1">'+e("Enable Mr. Assistant Bot","_txsb1")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is the main action of your chat bot on/off. If you click off no action will execute like livechat, bots, find visitors etc.</div></div>:</label>','<div class="s-action" id="mrA_support2">','<input id="mr-switch-1" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="assistantSupport">','<label for="mr-switch-1" class="mr-switch">Label</label><p class="s-row subLine">Enable MR. Assistant Bot  when you will not be online. MR. Assistant Bot will support your client as your train.</p>',"</div>","</div>",'<div class="s-row border">','<label for="kbBot">'+e("Chat Start method","_txsb2")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Choose one of chat start method how you want to visitors will start chatting with you, your agents, bots.</div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="chatWay">','<div class="s-row s-radio border2">','<input type="radio" name="chatWay" id="chatWay11" value="chatWithVisitors">','<label for="chatWay11"><h4>'+e("Chat With Visitors","_txsb3")+"</h4><p>There have two method to chat with visitors</p><p>1. Chat with visitors with Anonymous GUID and auth (Manually) </p><p>2. Chat with visitors with automatic Anonymous auth</p></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="chatWay" id="chatWay1" value="chatWithEmail">','<label for="chatWay1"><h4>'+e("Chat With Email and Name","_txsb4")+"</h4><p>Visitors need to input Name and Email to start conversation or supports.</p></label>","</div>",'<div class="r-box border2">','<div class="s-row s-radio ">','<input type="radio" name="chatWay" id="chatWay2"  value="chatAnonymously">','<label for="chatWay2"><h4>'+e("Chat Anonymously (No required Email and Name)","_txsb5")+"</h4><p>No Email and Name require in chat start but you can send sign up form in chatting session.</p></label>","</div>",'<div class="second"><input class="mrA_input" type="checkbox" data-action="checkbox" data-key="uniqueAnonymous">Generate unique id for Anonymous user</div>',"</div>",'<div class="s-row s-radio border2">','<input type="radio" name="chatWay" id="chatWay4" value="chatOffline">','<label for="chatWay4"><h4>'+e("Chat Offline (No save Chat history)","_txsb6")+'</h4><p>This is an offline chat for visitors. Here Visitors can chat with all Mr. Assistant bots except your live agents.</p><p class="subLine">Note: you can not chat with visitors and can not see any chat History. Only Bots will chat with your visitors</p></label>',"</div> ","</div>","</div>","</div>",'<div class="s-row border" style="margin-bottom: 80px;">',"<label>"+e("Remove Chat History","_txsb11")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Here you can automatically remove chat history except archive chat of your offline visitors within a time periods(user last seen). But this will not remove any archive chat history.</div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="removeChatHistory">','<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory1" value="1">','<label for="removeChatHistory1"><h4>'+e("Remove chat History after 1 day","_txsb12")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory2" value="7">','<label for="removeChatHistory2"><h4>'+e("Remove chat History after 7 day","_txsb13")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory3" value="30">','<label for="removeChatHistory3"><h4>'+e("Remove chat History after 30 day","_txsb14")+" </h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory4" value="0">','<label for="removeChatHistory4"><h4>'+e("Never remove any Chat History","_txsb15")+"</h4></label>","</div>","</div>","</div>","</div>","</section>","</div>"].join(""),n=['<div id="cbChatWithVisitors" class="cb-setting ">','<section class="mr-setting-block">','<div class="s-row border">','<label for="chatWithVisitor">'+e("Enable Visitors Cursor","_txsc1")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Enable Visitors Cursor to chat with your visitors when they are visiting your site. See what they browsing and guide them.</div></div>:</label>','<div class="s-action">','<input id="chatWithVisitor" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="chatWithVisitor">','<label for="chatWithVisitor" class="mr-switch">Label</label>','<p class="s-row subLine">'+e("Enable Visitors Cursor to Chat With Your live Visitors when someone visiting on your site.","_txsc2")+"</p>","</div>","</div>",'<div class="s-row border">',"<label>"+e("Chat With Visitors method","_txsc3")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Choose one of these methods. There have 2 powerful and secure options to chat with visitors. </div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="chatWithVisitorWay">','<div class="s-row s-radio border2">','<input type="radio" name="chatWithVisitorWay" id="chatWithVisitorWay2" value="anonymousGuidAuth">','<label for="chatWithVisitorWay2"><h4>'+e("Chat with visitors with Unique GUID and visitors Authentication (Manually Authentication) [Recommended]","_txsc5")+'</h4><p>This will Generate unique GUID for Every visitor Client. You need to Authenticate visitors by sending a chat request token to the visitor.</p><p class="subLine">Note: This will not Authenticate your all visitors automatically. So if you have much visitors traffic on your site then you can choose visitors as their browsing history and online status. This could not Authenticate visitors if they are offline or immediately leave the site in the of your sending chat request token.</p></label>',"</div>",'<div class="r-box border2">','<div class="s-row s-radio">','<input type="radio" name="chatWithVisitorWay" id="chatWithVisitorWay1" value="anonymousAuth">','<label for="chatWithVisitorWay1"><h4>'+e("Chat with visitors with automatic Anonymous auth","_txsc4")+'</h4><p>This will Authenticate your visitors immediately as Anonymous auth when someone visit your site</p><p class="subLine">Note: This will Authenticate your all visitors immediately. So if you have much visitors traffic on your site that can make you a little bit confusing in chat console. Because this will generate many live chat persons in the chat room. So you need many active live agents to handle this situation.</p></label>',"</div><br/>",'<div class="second">','<input class="mrA_input" type="checkbox" data-action="checkbox" data-key="offlineTracking"> '+e("Track your visitors all time (24/7)","_txsc6"),'<p class="subLine">Note: If you uncheck this option you can only Track your visitors when you would be online</p>',"</div>","</div>","</div>","</div>","</div>",'<div class="s-row border">',"<label>"+e("Remove Visitors","_txsc7")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Here you can automatically remove offline visitors within a time periods. </div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="removeVisitors">','<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors1" value="1">','<label for="removeVisitors1"><h4>'+e("Remove offline Visitors in 1 day","_txsc8")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors2" value="7">','<label for="removeVisitors2"><h4>'+e("Remove offline Visitors in 7 days","_txsc9")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors3" value="30">','<label for="removeVisitors3"><h4>'+e("Remove offline Visitors in 30 days","_txsc10")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors4" value="0">','<label for="removeVisitors4"><h4>'+e("Never remove any Visitor","_txsc11")+"</h4></label>","</div>","</div>","</div>","</div>","</section>","</div>"].join(""),i=['<div id="cbSearchEngine" class="cb-setting ">','<section class="mr-setting-block">','<div class="s-row border">','<label for="kbBot">'+e("Enable Knowledge Base","_txses1")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is a division of Mr. Assistant Bot. This will support with your Knowledge base question answering (KBQA) memory.</div></div>:</label>','<div class="s-action">','<input id="kbBot" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="kbBot">','<label for="kbBot" class="mr-switch">Label</label>',"</div>","</div>",'<div class="s-row border">','<label for="detectIssues">'+e("Detect Training Issues","_txses12")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">System will automatic detect training issues.</div></div>:</label>','<div class="s-action">','<input id="detectIssues" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="detectIssues">','<label for="detectIssues" class="mr-switch">Label</label>',"</div>","</div>",'<div class="s-row border">','<label for="sb_power">'+e("Control Search Power","_txses3")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">You can manage your knowledge base Search here. If you increase the power, system will match much exact result according to search weight.</div></div>:</label>','<div class="s-action">','<div class="range-box"><span class="range_val" data-key="sb_power"></span><input type="range" min="1" max="100" step ="0.25"  value="4" id="sb_power" class="mrA_input range-slider" data-action="range" data-key="sb_power"></div>','<p class="subLine">You can manage your knowledge base Search here. If you increase the power, system will match much exact result according to search weight. Default: 400</p>',"</div>","</div>",'<div class="s-row border">','<label for="notFound">'+e("Not Found Type","_txses4")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">By default, system will handle Not-found request. But you can choose custom handler to handle it yourself or keep it silent. Just update your _notFound action from Knowledge Base.</div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="notFound">','<div class="s-row s-radio border2">','<input type="radio" name="notFound" id="notFound0" value="silent">','<label for="notFound0"><h4>'+e("Keep Silent","_txses7")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="notFound" id="notFound1" value="system">','<label for="notFound1"><h4>'+e("System Handler","_txses5")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="notFound" id="notFound2" value="custom">','<label for="notFound2"><h4>'+e("Custom Handler","_txses6")+"</h4></label>","</div>","</div>","</div>","</div>",'<div class="s-row border">','<label for="botConfusion">'+e("Bot Confusion Response","_txses8")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">By default, system will handle when it would be confused about user input or could not find anything. But you can choose custom handler to handle it yourself or keep it silent. Just update your _botConfusion action from Knowledge Base.</div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="botConfusion">','<div class="s-row s-radio border2">','<input type="radio" name="botConfusion" id="botConfusion1" value="silent">','<label for="botConfusion1"><h4>'+e("Keep Silent","_txses9")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="botConfusion" id="botConfusion2" value="system">','<label for="botConfusion2"><h4>'+e("System Handler","_txses10")+"</h4></label>","</div>",'<div class="s-row s-radio border2">','<input type="radio" name="botConfusion" id="botConfusion3" value="custom">','<label for="botConfusion3"><h4>'+e("Custom Handler","_txses11")+"</h4></label>","</div>","</div>","</div>","</div>","</section>","</div>"].join(""),s=['<div id="cbMenus" class="cb-setting">','<div class="s-row menu-box"><button class="btn btn-danger" id="mr_create_menu">Create New Menu</button></div>','<section style="display: none" id="mrMenuTree" class="mr-setting-block border">','<input class="mrA_input" id="mrMenuID" type="hidden" data-action="text" data-key="menuID" value=""> ','<div class="s-row">','<label for="menuName">'+e("Menu name","_txsm1")+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Add a public facing Menu name. Menu name can be like current offer, discount, coupon or as your demand.</div></div>:</label>','<div class="s-action"><input id="menuName" class="mrA_input mr-main__input" placeholder="Menu Name" type="text" data-action="text" data-key="menuName"></div>',"</div>",'<div class="s-row">','<label for="menuUrl">'+e("Menu Image url","_txsm2")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Add menu icon URL or add an icon from Unified icons framework(iconify). This will show top of menu name.</div></div>:</label>','<div class="s-action" ><input id="menuUrl" class="mrA_input mr-main__input" placeholder="ICON URL or ICON from Unified icons framework(iconify)" type="text" data-action="text" data-key="menuUrl">','<p class="subLine">Add menu icon URL or add an icon from Unified icons framework(iconify). <a href="https://iconify.design/icon-sets/" target="_blank">Get an ICON</a></p></div>',"</div>",'<div class="s-row">','<label for="menuContext">'+e("Menu Content","_txsm3")+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is the menu content according to menu context.  </div></div>:</label>','<div class="s-action"><textarea name="menuContext" id="menuContext" class="mrA_input mr-main__input" placeholder="Write Menu Context" type="text" data-action="text" data-key="menuContext"></textarea>','<p class="subLine">To see content in the menu you must select "context action" from Menu Action type</p></div>',"</div>",'<div class="s-row">','<label for="menuAction">'+e("Menu Action Type","_txsm4")+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is the option of menu actions how to execute menu action.</div></div>:</label>','<div class="s-action">','<select id="menuAction" class="mrA_input mr-main__input" data-action="text" data-key="menuAction"><option value="contextAction" selected>Context Action</option><option value="kb">Knowledge Base Action</option><option value="redirectAction">Open URL Action</option><option value="help">Help Action</option><option value="menu">Menu Action</option></select>',"</div>","</div>",'<div class="s-row">','<label for="actionContext">'+e("Add Action","_txsm5")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This option is relative to menu actions - Context Action(no input), Redirect Action(Input Url), Search Action(action context) etc. </div></div>:</label>','<div class="s-action">','<p id="mr_action_show"></p>','<input id="actionContext" style="display:none" class="mrA_input mr-main__input" placeholder="Action Context" type="text" data-action="text" data-key="actionContext">','<p class="subLine"></p>',"</div>","</div>",'<div class="s-row">',"<label>"+e("Status","_txsm6")+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This will represent current status of menu to display in chat widget.</div></div>:</label>','<div class="s-action" id="mr_user_active">','<input id="mrUA" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="status">','<label for="mrUA" class="mr-switch">Label</label>',"</div>","</div>",'<div class="s-row">',"<label></label>",'<div class="s-action"><button class="btn btn-danger" id="mr_menu_save" data-key="" data-action="create">Create Menu</button></div>',"</div><br/>","</section>",'<table class="mrTable"><thead id="mrMenusListHead"></thead><tbody id="mrMenusTable"></tbody></table>',"</div>"].join(""),o=['<div id="cbHelp" class="cb-setting">','<section id="mrHelp" class="mr-setting-block">','<div class="s-row border">','<label for="helpTitle">'+e("Title","_txsh1")+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is Help menu Title in public facing pop box in chat widget.</div></div>:</label>','<div class="s-action"><input id="helpTitle" class="mrA_input mr-main__input" placeholder="Write Title" type="text" data-action="text" data-key="helpTitle"></div>',"</div>",'<div class="s-row border">','<label for="helpContent">'+e("Help Content","_txsh2")+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">There you may input help context about how to use your service and little guide about your service.</div></div>:</label>','<div class="s-action"><textarea id="helpContent" class="mrA_input mr-main__input" placeholder="Write Content" type="text" data-action="text" data-key="helpContent"></textarea></div>',"</div>",'<div class="s-row ">',"<label></label>",'<div class="s-action"><button class="btn btn-danger" id="mr_help_save">Save</button></div>',"</div>","</section>","</div>"].join("");return[t,a,n,i,s,['<div id="cbTranslation" class="cb-setting">','<section id="mrHelp" class="mr-setting-block">','<div class="s-row txHeader">',"</div>",'<div class="txBody">',"</div>",'<br/><br/><p>Select One of the page on top to translate.</p><p class="subLine">Note: Translatable text will Bring up for pages in the time of Browsing on-page. So if you don\'t show your desire translatable text you need to browse on this portion to extract translatable text.</p>',"</section>","</div>"].join(""),o,"</div></div></div></div>"].join("")}():"mr-knowledge-base"===t?['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header mr_t_issues">','<h2 id="cb-title"><span class="iconify" data-icon="logos:backbone-icon"></span> '+e("Knowledge base question answering (KBQA)","_txk1")+"</h2>",'<h2 id="tIssue_btn"><span class="iconify" data-icon="whh:issueclosed"></span> '+e("Training Issues","_txkti1")+"</h2>","</div>",'<div class="draggable_box"><div id="tIssues" draggable="true" data-action="sleep" style="display:none;">','<div id="tIssues_head">','<div class="issueHeadText"><span class="iconify" data-icon="whh:issueclosed"></span> Training Issues</div>','<div id="issueHeadConfig"><span class="iconify" data-icon="whh:dropmenu" data-inline="true"></span></div>','<div id="issueHeadClose"><span class="iconify" data-icon="emojione:cross-mark-button" data-inline="true"></span></div>',"</div>",'<ul id="issueHeadConfigBox" style="display:none"><li id="delAllIssues">Delete All Issues</li></ul>','<div class="tIssues_box">','<ul id="tIssues_body"></ul>','<div id="tIssues_footer"></div>',"</div>","</div></div> ",'<div class="mr-main__content mr_train_container">','<div class="mr-main__settings-form">','<div id="cbAppearance2" class="cb-setting active">','<section class="mr-setting-block">','<div id="cbKnowledgeBase">','<section class="mr-setting-block">','<div class="mr-flex-center">','<label class="mr-main__input-label">'+e("Search and Add Knowledge Base ","_txk2")+"</label>",'<div class="mr-flex mr-relative">','<input id="mr_search_kb" class="mr-main__input" placeholder="Question.." type="text">','<button id="mr_add_kb" data-action="mr_add">Add</button>',"</div>",'<div class="mr-flex mr-relative">','<label class="mr-main__input-label"></label>','<ul id="mr_kb_found"></ul>',"</div>","</div>",'<div id="showHideKnowledge" class="mr_right_text"><i class="fa fa-angle-down"></i></div>','<div id="addKnowledge" style="display: none;"></div>','<table class="mrTable"><thead id="mrKnowledgeListHead"></thead><tbody id="mrKnowledgeList"></tbody></table>',"</section>","</div>","</section>","</div>","</div>","</div>","</div>","</div>"].join(""):"mr-chat-history"===t?['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header">','<h2 id="cb-title"><span class="iconify" data-icon="fa-solid:history"></span> '+e("Chat History","_txh1")+"</h2>","</div>",'<div class="mr-main__content">','<div class="mr-main__settings-form">','<div class="mr-dash-box">','<h2 class="dash-title1"><span class="iconify" data-icon="entypo:users"></span> '+e("All Users Chat History on your site","_txh2")+"</h2>","<p>"+e("View Users previous conversation or delete users chat history.","_txh3")+"</p>",'<span class="iconify visitor-img history-img" data-icon="fa:history"></span>',"</div>",'<div id="cbAppearance" class="cb-setting active">','<section class="mr-setting-block">','<div id="clientsSetting" >','<h2 class="table-title">'+e("All Users List","_txh4")+"</h2>",'<div class="mrLIstPagination">','<table class="mrTable"><thead id="mrClientsListHead"></thead><tbody id="mrClientsList"></tbody></table>',"</div>","</div>","</section>","</div>","</div>","</div>","</div>","</div>"].join(""):"mr-user-profile"===t?['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header">','<h2 id="cb-title"><span class="iconify" data-icon="fa-solid:user"></span> '+e("My Account","_txp1")+"</h2>","</div>",'<div class="mr-main__content">','<div class="mr-main__settings-form">','<div id="userProfile">','<section id="mrUpdateUserProfile" class="mr-setting-block">','<div class="s-row">','<label for="mrDisplayName">'+e("User Profile Url:","_txp2")+" </label>",'<div class="s-action">','<input id="mrUpdatePhotoUrl" class="mrA_input mr-main__input" placeholder="Display Name" type="text" data-action="text" data-key="name">',"</div>","</div>",'<div class="s-row">','<label for="mrDisplayName">'+e("Display name: ","_txp3")+"</label>",'<div class="s-action">','<input id="mrUpdateDisplayName" class="mrA_input mr-main__input" placeholder="Display Name" type="text" data-action="text" data-key="name">',"</div>","</div>",'<div class="s-row">','<label for="mrDisplayName">'+e("User Email: ","_txp4")+"</label>",'<div class="s-action">','<input id="mrUpdateUserEmail" disabled class="mrA_input mr-main__input" placeholder="Display Name" type="text" data-action="text" data-key="name">',"</div>","</div>",'<div class="s-row">','<label for="mrPass"></label>','<div class="s-action">','<button class="btn btn-primary" id="mr_update_user_profile" data-uid="" data-type="">Update User</button>',"</div>","</div>","</section>","</div>",'<h2 class="table-title"><span class="iconify" data-icon="gridicons:multiple-users"></span> '+e("Operators List","_txp5")+"</h2>",'<table class="mrTable"><thead id="mrUsersListHead"></thead><tbody id="mrUsersList"></tbody></table>',"</div>","</div>","</div>","</div>"].join(""):void 0},loader:'<div class="mr-load"><span></span><span></span><span></span><span></span></div>'}}(),e.prototype.template=function(){function e(e){let a=mrAssistantObj.plugin_url+"assets/images/boy.svg";try{if(""!==e&&t.common.isset(mrUserAssets)&&mrUserAssets.hasOwnProperty(e)){let t=mrUserAssets[e];if(t.hasOwnProperty("avatar")&&""!==t.avatar)return t.avatar}}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}return a}return{templateDark:function(a,n,i){if(!document.getElementById("mr"+a))return function(a,n,i){if(!n.hasOwnProperty("text")||"string"!=typeof n.text||""===n.text)return;const s=document.createElement("DIV"),o=document.createElement("DIV");o.setAttribute("class","meg-wrapper"),s.setAttribute("class","message fade "+(""!==n.type?n.type:"bot")),s.setAttribute("id","mr"+a);const r=document.createElement("span");r.setAttribute("class","message-content"),r.appendChild(document.createTextNode(n.text));let c=n.name&&""!==n.name?'<p class="user">'+n.name+"</p>":"",l="client"===n.type?"theme":"";if(o.innerHTML=c+'<span class="message-content '+l+'">'+n.text+"</span>","bot"!==n.type){const e=document.createElement("div");e.setAttribute("class","time"),e.appendChild(document.createTextNode(t.common.getDateTime(n.time))),s&&o.appendChild(e)}s.append(o);let d=document.createElement("DIV"),u=document.createElement("IMG");u.width=25,u.height=25,d.setAttribute("class","avatar-wrapper"),u.setAttribute("class","avatar"),u.setAttribute("id","mrImg-"+a);let m=mrAssistantObj.plugin_url+"assets/images/mr-assistant.svg",p="";"bot"===n.type?(p=mrBot&&mrBot.hasOwnProperty("avatar")?mrBot.avatar:m,u.src=p,s&&(d.append(u),s.prepend(d))):"admin"===n.type&&(u.src=e(n.uid),m=mrAssistantObj.plugin_url+"assets/images/boy.svg",s&&(d.append(u),s.prepend(d))),t.common.image(a,p,m,"imgSrc");let h=document.getElementById("admin-messages");if(h)if("prepend"===i){h.prepend(s);let e=document.getElementById("admin-messages");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}else{h.appendChild(s);let e=document.getElementById("admin-messages");e&&e.scrollIntoView({behavior:"smooth",block:"end"})}}(a,n,i)},getAvatar:e,addKnowledgeBase:function(e){let t=function(t){return e.hasOwnProperty("status")&&parseInt(e.status)===t?'checked="checked"':2===t?'checked="checked"':""};return['<section><div id="hideKB" >⤬</div>','<div class="mrTheme KbStatus">',`<label for="theme1"><input type="radio" name="KbStatus" id="theme1" value="2" ${t(2)}><p style="background: #fbc490">Search & Action</p></label>`,`<label for="theme2"><input type="radio" name="KbStatus" id="theme2" value="1" ${t(1)}><p style="background: #cd8d7b">Only Action</p></label>`,`<label for="theme3"><input type="radio" name="KbStatus" id="theme3" value="0" ${t(0)}><p style="background: #687466">Unpublished</p></label>`,"</div>",'<div class="mr-flex">','<label class="mr-main__input-label">Question <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Training Question that will one of fact stored in the knowledge base (KB) memory. When the user will ask one Question, KB will replay the answer by using facts stored in a knowledge base (KB).</div></div>:</label>',`<div class="mr-main__input"><input id="mr_question" value="${e.que?e.que:""}" class="mr-main__input" placeholder="Add Title" type="text">`,'<p class="subLine">Training Question that will one of fact stored in the knowledge base (KB) memory.</p></div>',"</div>",'<div class="mr-flex">','<label class="mr-main__input-label">Related Question <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Related Question are words (or combination of words) you can utilize on Guide question to improve the search experience of Knowledge base Question. Related Question are indexed for search with a little less weight as the Question, but multiple labels with similar words can outweigh the search of the Question, so use labels carefully to balance your search results.</div></div>:</label>','<div class="mr-main__input">','<div id="mr_tags_show"></div>',`<textarea id="mr_tags" class="mr-main__input" placeholder="Add Related Label" type="text">${e.tag?e.tag:""}</textarea>`,'<p class="subLine">Related Labels are indexed for search with less weight as the Question, but multiple labels with similar words can outweigh the search of the Question, so use labels carefully to balance your search results.</p>',"</div>","</div>",'<div class="mr-flex">','<label class="mr-main__input-label">Answers <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Output: KB, training Question Answer that will be store relatively to this Question in the knowledge base (KB) memory. When the user will ask one Question, KB will replay this answer.</div></div>:</label>','<div class="mr-main__input">',`${function(e){let t=[],a="";if(e&&e.constructor===Object&&Object.keys(e).length>0){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],s=parseInt(n.replace(/\D/g,""));for(var o in t.push(s),a+='<div class="kbAnsBox" data-id="'+s+'" data-key="'+n+'"><div class="kbAnsRows">',i)i.hasOwnProperty(o)&&(a+='<div class="kbAnsRow"><textarea class="moreAnswer mr-main__input" data-id="" data-key="'+o+'">'+i[o]+'</textarea><div class="kbRemoveAns kbRemoveBtn">&times;</div></div>');a+='</div><div class="kbAddNewAns">&#43; Add New Answer</div>',a+='<div class="kbRemoveAns kbRemoveAnsCss">&times; Remove This Block</div>',a+="</div>"}}else a+='<div class="kbAnsBox" data-id="0" data-key="ans0">',a+='<div class="kbAnsRows"><div class="kbAnsRow"><textarea class="moreAnswer mr-main__input" data-id="1" data-key="a1"></textarea><div class="kbRemoveAns kbRemoveBtn">&times;</div></div></div>',a+='<div class="kbAddNewAns">&#43; Add New Answer</div>',a+='<div class="kbRemoveAns kbRemoveAnsCss">&times; Remove This Block</div>',a+="</div>";let r=1|(t?Math.max.apply(Math,t)+1:1);return'<div id="cbMoreKnowledge">'+a+["</div>",'<div class="mr-btn-right">','<button id="cbAddMoreAnswer" data-id="'+r+'" data-key="ans'+r+'">&#43; Add Next Answer Block</button>',"</div>"].join("")}(e.ans?e.ans:{})}`,'<p class="subLine">Add Answer that will appear in the chat widget on search. You can add multiple answers by clicking on <strong>Add New Answer</strong> that will appear randomly. Also, You can add Multiple answers block by clicking on <strong>Add Next Answer Block</strong>.</p>',"</div>","</div>",'<div class="mr-flex">','<label class="mr-main__input-label">Next Action<div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Next Action will be Executed automatically and simultaneously when this Knowledge base will be finished.</div></div>:</label>','<div class="mr-main__input">','<div class="">','<select id="mr_action_type" class="mr-main__input">','<option value="">Select Action </option>',`<option value="kb" ${e.type&&"kb"===e.type?"selected":""}>Knowledge Base Action</option>`,`<option value="redirect" ${e.type&&"redirect"===e.type?"selected":""}>Open URL Action</option>`,`<option value="help" ${e.type&&"help"===e.type?"selected":""}>Help Action</option>`,`<option value="menu" ${e.type&&"menu"===e.type?"selected":""}>Menu Action</option>`,`<option value="rate" ${e.type&&"rate"===e.type?"selected":""}>Ratting Action</option>`,"</select>","</div>",'<div class="">','<div id="mr_action_show"></div>',`<input id="mr_action" style="display:;" value="${e.act?e.act:""}" class="mr-main__input" placeholder="Next Action" type="text">`,'<p class="subLine">Note: Next Action will be Executed automatically in a loop. To avoid infinitive loop or better user experience this system will block loop after 2 label deep.</p>',"</div>","</div>","</div>",'<div class="mr-flex">','<label class="mr-main__input-label">Suggestions <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Suggestions are another Question of KB that will be Related to this Question. This task will be executed when Answering is finished.</div></div>:</label>','<div class="mr-main__input">',`<ul id="mr_related_action_results">${function(e){let t="";for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];t+='<li data-key="'+n.key+'"><span class="mr_rel_text">'+n.val+'</span><span data-action="mr_edit">✎</span><span data-action="mr_delete">⤬</span></li>'}return t}(e.rel?e.rel:"")}</ul>`,'<div class="mr-relative">','<input id="mr_related_action_search" class="mr-main__input" placeholder="Add Related Suggestions" type="text">','<ul id="mr_related_action_found"></ul>',"</div>",'<p class="subLine">Note: Suggestions are another Knowledge base Question. Suggestions will be Executed when <strong>Next Action</strong> will be empty.</p>',"</div>","</div>",'<div class="mr-flex">',`<button class="mr-button mr-shadow" data-key="${""!==e.key?e.key:""}" id="saveKnowledge">Update</button>`,"</div></section>"].join("")}}}(),e.prototype.menus=function(){function e(e){if(e&&""!==e)firebase.database().ref().child("/menus/").child(e).once("value").then(function(e){t.common.setOptionConfig("#mrMenuTree .mrA_input",e.val())});else{t.common.setOptionConfig("#mrMenuTree .mrA_input",{menuID:"",menuName:"",menuUrl:"",menuContext:"",menuAction:"",actionContext:"",status:1});const e=document.getElementById("mrMenuTree"),a=document.getElementById("mr_menu_save");e.style.display="block",a.innerText="Create New menu",a.dataset.action="create"}const a=document.getElementById("menuAction");a&&a.addEventListener("input",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.getElementById("mr_action_show"),a=document.getElementById("actionContext");t&&a&&("contextAction"===this.value?(t.innerHTML="Add HTML content in Menu Content section.",a.style.display="none"):"kb"===this.value?(t.innerHTML="Add Another Knowledge Base here",a.style.display="block"):"redirectAction"===this.value?(t.innerHTML="Add Url here. ",a.style.display="block"):(t.innerHTML="This is functional action. Execute automatically.",a.style.display="none"))},!0)}function a(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var a=t.target.dataset.key,n=t.target.dataset.action;if("update"===n){""!==a&&e(a);const t=document.getElementById("mrMenuTree"),n=document.getElementById("mr_menu_save");t.style.display="block",n.innerText="Update menu",n.dataset.action="update"}else"delete"===n&&confirm("Are you Sure?")&&""!==a&&firebase.database().ref("menus/").child(a).remove().then(function(){let e=document.getElementById("mu"+a);e&&e.remove()})}function n(e){const t=document.querySelector(".mr-container");if(t&&"mr-chatbot-settings"===t.dataset.action){var n=document.getElementById("mrMenusTable"),i=e.val(),s=e.key;let t=document.getElementById("mu"+s);t&&t.remove();var o=document.createElement("TR");o.setAttribute("id","mu"+s),o.innerHTML=(e=>["<td>"+i.menuName+"</td>","<td>"+i.menuAction+"</td>",(i.status,"Active")].join(""))();const r=document.createElement("SPAN");r.setAttribute("class","vChat btn-green"),r.innerText="Update",r.setAttribute("data-action","update"),r.setAttribute("data-key",s),r.addEventListener("click",a,!0);const c=document.createElement("SPAN");c.setAttribute("class","vChat"),c.innerText="Delete",c.setAttribute("data-action","delete"),c.setAttribute("data-key",s),c.addEventListener("click",a,!0);const l=document.createElement("TD");l.append(r),l.append(c),o.append(l),n&&n.prepend(o)}}function i(e){e.target.dataset.action,e.target.dataset.key;document.querySelectorAll("#mrMenuTree .mrA_input");var a=t.common.getObject("#mrMenuTree .mrA_input");a.menuID&&""!==a.menuID?firebase.database().ref().child("/menus/").child(a.menuID).update(a):firebase.database().ref().child("/menus/").push(a).then(function(t){const a=t.key;e.target.dataset.action="update",e.target.innerText="Update Menu";let n=document.getElementById("mrMenuID");n&&(n.value=a),firebase.database().ref().child("/menus/").child(a).update({menuID:a})})}return{execute:function(a){if("#cbHelp"===a)return function(){const e=document.getElementById("mr_help_save");e&&e.addEventListener("click",function(e){let a=t.common.getObject("#mrHelp .mrA_input");a&&a.hasOwnProperty("helpContent")&&firebase.database().ref().child("/help/").update(a)},!0),firebase.database().ref("help/").on("value",function(e){let a=e.val();const n=document.querySelector(".mr-container");n&&"mr-chatbot-settings"===n.dataset.action&&a&&a.hasOwnProperty("helpContent")&&t.common.setOptionConfig("#mrHelp .mrA_input",a)})}();const s=document.getElementById("mr_menu_save");s&&s.addEventListener("click",i);const o=document.getElementById("mr_create_menu");o&&o.addEventListener("click",function(t){var a=document.getElementById("mrMenuTree");a.style.display="none"===a.style.display?"":"none",e("")}),firebase.database().ref("menus/").orderByKey().on("child_added",n),firebase.database().ref("menus/").orderByKey().on("child_changed",n);let r=document.getElementById("mrMenusListHead");r&&(r.innerHTML='<tr class="vcHeader"><th>Menu Name</th><th>Action</th><th>Status</th><th>Action</th></tr>')},coreAction:a}}(),e.prototype.trainingIssues=function(){let e={};function t(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=e.target.dataset.action,a=e.target.parentNode.dataset.key;if("mr_set_issue"===t){const t=e.target.innerText;if(t&&""!==t){const e=document.getElementById("mr_search_kb");e&&(e.value=t)}}else"mr_ok_issue"===t?firebase.database().ref("training").child(a).update({sts:2}).then(function(){const e=document.getElementById("is"+a);e&&e.classList.add("issue_ok")}):"mr_del_issue"===t&&firebase.database().ref("training").child(a).remove().then(function(){const e=document.getElementById("is"+a);e&&e.remove()})}function a(e,a,n="prepend"){const i=document.getElementById("tIssues_body"),s=document.createElement("LI");s.setAttribute("data-key",e),s.setAttribute("id","is"+e),a.sts&&2===a.sts&&s.setAttribute("class","issue_ok");const o=document.createElement("SPAN");o.setAttribute("class","issueText "),o.innerText=a.qs||"",o.setAttribute("data-action","mr_set_issue"),o.addEventListener("click",t,!0),s.append(o);const r=document.createElement("SPAN");r.setAttribute("class","iBtn"),r.innerHTML="✓",r.setAttribute("data-action","mr_ok_issue"),r.addEventListener("click",t,!0),s.append(r);const c=document.createElement("SPAN");c.setAttribute("class","iBtn iBtn_del"),c.innerHTML="⤬",c.setAttribute("data-action","mr_del_issue"),c.addEventListener("click",t,!0),s.append(c),i&&("append"===n?i.append(s):i.prepend(s))}function n(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const n=document.getElementById("tIssues");if(n){!function(e){var t=0,a=0,n=0,i=0;function s(e){(e=e||window.event).preventDefault(),n=e.clientX,i=e.clientY,document.onmouseup=r,document.onmousemove=o}function o(s){(s=s||window.event).preventDefault(),t=n-s.clientX,a=i-s.clientY,n=s.clientX,i=s.clientY,e.style.top=e.offsetTop-a+"px",e.style.left=e.offsetLeft-t+"px"}function r(){document.onmouseup=null,document.onmousemove=null}document.getElementById(e.id+"header")?document.getElementById(e.id+"header").onmousedown=s:e.onmousedown=s}(n);let t=n.dataset.action||"sleep";if(n.style.display="none"===n.style.display?"":"none","sleep"===t){n.dataset.action="listening";document.getElementById("tIssues_body");firebase.database().ref("training").orderByChild("/time").limitToLast(10).on("child_added",function(e){const t=document.getElementById("tIssues");if(!t||"listening"!==t.dataset.action)return;let n=e.val();n&&a(e.key,n)}),function(){let t=function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let n,i,s=e,o=Object.keys(s).length,r=parseInt(this.parentNode.dataset.start),c=parseInt(this.parentNode.dataset.end),l=parseInt(this.parentNode.dataset.step);"prev"===this.dataset.type?(n=r-l,i=r):(n=c,i=c+l);let d=n>0?n-1:0,u=i<o?i-1:o-1;if(u<=0||n>=o)return;let m=Object.entries(s).sort((e,t)=>{if(e[1].time&&t[1].time)return t[1].time-e[1].time}).slice(d,u);const p=document.getElementById("tIssues_body");p&&(p.innerHTML="");for(let e=0;m.length>e;e++)if(m[e]){let t=m[e][0];s.hasOwnProperty(t)&&a(t,s[t],"append")}const h=document.querySelector(".mrIsPagination");h&&(h.dataset.start=d+1,h.dataset.end=u+1,h.dataset.counter=o);const v=document.querySelector(".mrIsPagiStatus");v&&(v.innerHTML="( "+parseInt(d+1)+" - "+parseInt(u+1)+" ) / "+o)};firebase.database().ref("training/").orderByChild("time/").once("value",function(a){let n=a.val(),i=document.getElementById("tIssues_footer");if(n){e=Object.assign({},n);let a=Object.keys(n).length;if(a>10){const e=document.createElement("DIV");e.setAttribute("class","mrIsPagination"),e.setAttribute("data-start",1),e.setAttribute("data-end",11),e.setAttribute("data-counter",a),e.setAttribute("data-step",10);const n=document.createElement("DIV");n.innerText="Prev",n.setAttribute("data-type","prev"),n.addEventListener("click",t,!0);const s=document.createElement("DIV");s.setAttribute("class","mrIsPagiStatus"),s.innerHTML="(1 - 11) / "+a;const o=document.createElement("DIV");o.innerText="Next",o.setAttribute("data-type","next"),o.addEventListener("click",t,!0),e.append(n),e.append(s),e.append(o),i&&i.append(e)}}else i&&(i.innerHTML="No Issues")})}()}}}return{execute:function(){const e=document.getElementById("tIssue_btn");e&&e.addEventListener("click",n,!0);const t=document.getElementById("issueHeadConfig");t&&t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.getElementById("issueHeadConfigBox");t&&(t.style.display="none"===t.style.display?"":"none")},!0);const a=document.getElementById("delAllIssues");a&&a.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),firebase.database().ref("training").set("");const t=document.getElementById("tIssues_body");t&&(t.innerHTML="No Issues");const a=document.getElementById("tIssues_footer");a&&(a.innerHTML="")},!0);const i=document.getElementById("issueHeadClose");i&&i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.getElementById("tIssues");t&&(t.style.display="none")},!0)}}}(),e.prototype.knowledgeBase=function(){let e={},a=Date.now();function n(e){return e}function i(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=e.target.dataset.key,a={};document.getElementById("addKnowledge");let i=document.querySelector('input[name="KbStatus"]:checked');a.status="2",i&&(a.status=i.value);const s=document.getElementById("mr_question");if(!s.value)return;a.que=n(s.value);const o=document.getElementById("mr_tags");a.tag=o.value?n(o.value):"";let r=document.querySelectorAll("#cbMoreKnowledge .kbAnsBox");if(r){let e={};r.forEach(function(t){let a=t.dataset.key,i=t.querySelectorAll("#cbMoreKnowledge .moreAnswer");if(""!==a&&i){let t={},s=1;if(i.forEach(function(e){""!==n(e.value)&&(t["a"+s]=e.value?n(e.value):"",s++)}),Object.keys(t).length>0){let n={};n[a]=t,Object.assign({},e,n),e[a]=t}}}),Object.keys(e).length>0&&(a.ans=e)}const c=document.getElementById("mr_action_type");let l=c.options[c.selectedIndex].value;l&&""!==l&&(a.type=l);const d=document.getElementById("mr_action");""!==d.value&&(a.act=d.value?n(d.value):"");const u=document.querySelectorAll("#mr_related_action_results li");let m=[];u.forEach(function(e){let t={};const a=e.querySelector(".mr_rel_text"),n=e.getAttribute("data-key");n&&(t.key=n),a&&(t.val=a.innerText),m.push(t)}),a.rel=m,""!==t&&(a.time=Date.now(),a.key=t,firebase.database().ref().child("/knowledgeBase/"+t).set(a).then(function(){const e=document.getElementById("hideKB");e&&e.click()}))}function s(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=e.target.dataset.action;if("mr_edit"===t){return p(e.target.parentNode.dataset.key)}if("mr_delete"===t){document.getElementById("mr_related_action_results").removeChild(e.target.parentNode)}}function o(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.getElementById("mr_related_action_found"),a=document.getElementById("mr_related_action_results");let n=null,i=e.target.value;n&&clearTimeout(n),n=setTimeout(function(){""!==i&&(async()=>{let e=await m(i);if(e&&t){let i="";e.forEach(function(e){i+='<li class="mr-related-row" data-key="'+e.doc.key+'">'+e.doc.que+"</li>"}),t.style.display="block",t.innerHTML=i;var n=document.querySelectorAll(".mr-related-row");n&&n.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=e.target.dataset.key,n=e.target.innerText;const i=document.createElement("LI");i.setAttribute("data-key",t),i.innerHTML='<span class="mr_rel_text">'+n+"</span>";let o=document.createElement("span");o.setAttribute("data-action","mr_edit"),o.innerHTML="&#9998;",o.addEventListener("click",s,!0),i.appendChild(o);let r=document.createElement("span");r.setAttribute("data-action","mr_delete"),r.innerHTML="&#10540;",r.addEventListener("click",s,!0),i.appendChild(r);let c=a.childNodes,l=!0;c&&c.forEach(function(e){e.dataset.key===t&&(l=!1)}),l&&a.appendChild(i)},!0)})}})()},1e3)}function r(){const e=document.createElement("DIV");e.setAttribute("class","kbAnsRow");const t=document.createElement("TEXTAREA");t.setAttribute("class","moreAnswer mr-main__input");const a=document.createElement("DIV");return a.setAttribute("class","kbRemoveAns kbRemoveBtn"),a.innerHTML="&times;",a.addEventListener("click",c,!0),e.append(t),e.append(a),e}function c(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.target.parentNode&&e.target.parentNode.parentNode.childNodes.length>1&&e.target.parentNode.remove()}function l(e){let t=document.querySelector("#cbMoreKnowledge .kbAnsRows");if(t&&t.lastChild){let t=e.target.parentNode.firstChild;t&&"kbAnsRows"===t.className&&t.appendChild(r())}}function d(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=parseInt(e.target.dataset.id)+1;const a=document.createElement("DIV");a.setAttribute("class","kbAnsBox moreAnswer"),a.setAttribute("data-id",e.target.dataset.id),a.setAttribute("data-key",e.target.dataset.key);const n=document.createElement("DIV");n.setAttribute("class","kbAnsRows"),n.append(r()),a.append(n);const i=document.createElement("DIV");i.setAttribute("class","kbAddNewAns"),i.innerHTML="&#43; Add New Answer",i.addEventListener("click",l,!0),a.append(i);const s=document.createElement("DIV");s.setAttribute("class","kbRemoveAns kbRemoveAnsCss"),s.innerHTML="&times; Remove This Block",s.addEventListener("click",c,!0),a.append(s),document.getElementById("cbMoreKnowledge").appendChild(a),e.target.setAttribute("data-id",t),e.target.setAttribute("data-key","ans"+t),e.target.innerHTML="&#43; Add Next Answer Block"}function u(){setTimeout(function(){const e=document.getElementById("hideKB"),t=document.getElementById("addKnowledge"),a=(document.getElementById("cbMoreKnowledge"),document.getElementById("cbKnowledgeTags"),document.getElementById("cbAddMoreAnswer")),n=(document.getElementById("mr_tags"),document.getElementById("mr_action_type")),r=document.querySelectorAll("#mr_related_action_results li");document.querySelectorAll("#mr_related_action_results li");a.addEventListener("click",d,!0),a.innerHTML="&#43; Add Next Answer Block";let u=document.querySelectorAll("#addKnowledge .kbRemoveAns");u&&u.forEach(function(e){e.addEventListener("click",c,!0)});let m=document.querySelectorAll("#addKnowledge .kbAddNewAns");m&&m.forEach(function(e){e.addEventListener("click",l,!0)}),mr_related_action_search&&(mr_related_action_search.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.target.value.length>0&&(document.getElementById("mr_related_action_found").style.display="block")},!0),mr_related_action_search.addEventListener("input",o,!0)),r&&r.forEach(e=>{let t=e.querySelectorAll("span");t&&t.forEach(e=>{let t=e.dataset.action;["mr_edit","mr_delete"].includes(t)&&e.addEventListener("click",s,!0)})}),document.querySelector("#saveKnowledge").addEventListener("click",i,!0);var p=document.querySelectorAll(".mr_base_action");p&&p.forEach(e=>e.addEventListener("click",h,!0)),e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t&&(t.style.display="none")},!0),n&&n.addEventListener("input",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),function(e){const t=document.getElementById("mr_action_show"),a=document.getElementById("mr_action");t&&a&&("search"===e?(t.innerHTML="Add your Search string for this Action.",a.style.display="block"):"kb"===e?(t.innerHTML="Add Another Knowledge Base name(Question) for this Action.",a.style.display="block"):"redirect"===e?(t.innerHTML="Add a valid Url here. Also you can do this with search Action.",a.style.display="block"):(t.innerHTML="Automatically Execute this Action.",a.style.display="none"))}(this.value)},!0)},1e3)}async function m(t){let a=elasticlunr(function(){this.addField("que"),this.addField("tag"),this.setRef("key")});return Object.keys(e).map(function(t){var n=e[t];a.addDoc({key:t,que:n.que,tag:n.tag})}),a.search(t,{fields:{que:{boost:2},tag:{boost:1}}})}function p(e){var a=function(e={}){return new Promise(e=>e(1)).then(()=>{let a=t.template.addKnowledgeBase(e);const n=document.getElementById("addKnowledge");n&&(n.innerHTML=a,n.style.display="block")}).then(function(){setTimeout(function(){u()},1e3)})};if(!e)return a({});firebase.database().ref("/knowledgeBase/"+e).once("value").then(function(e){var t=e.val();return t.key=e.key,a(t)})}function h(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=e.target.dataset.action,a=e.target.dataset.key;if("mr_list_edit"===t){if(a)return p(a)}else"mr_list_delete"===t&&confirm("Are you Sure?")&&a&&firebase.database().ref("knowledgeBase/").child(a).remove().then(function(){let e=document.getElementById("kb"+a);e&&e.remove()})}function v(e,a,n){const i=document.getElementById("mrKnowledgeList");var s=a;let o=document.getElementById("kb"+e);o&&o.remove();let r="";if(s.ans&&s.ans.constructor===Object&&Object.keys(s.ans).length>0){let e=Object.values(s.ans);if(e[0]){let t=Object.values(e[0]);r=t[0]?t[0]:""}}else s.ans&&s.ans.constructor===String&&(r=s.ans);let c=[`<td>${s.que&&s.que.length>20?s.que.substring(0,20)+"..":s.que}</td>`,`<td>${r.length>20?r.substring(0,20)+"..":r}</td> `,`<td>${s.man&&s.man.length>0?s.man.length:"0"}</td>`,`<td>${s.rel&&s.rel.length>0?s.rel.length:"0"}</td>`,`<td>${s.type||""}</td>`,`<td>${t.common.getLocalTime(s.time)}</td>`].join("");var l=document.createElement("TR");l.setAttribute("id","kb"+e),l.innerHTML=c;const d=document.createElement("SPAN");d.setAttribute("class","vChat btn-green"),d.innerText="✎ Edit",d.setAttribute("data-action","mr_list_edit"),d.setAttribute("data-key",e),d.addEventListener("click",h,!0);const u=document.createElement("SPAN");u.setAttribute("class","vChat"),u.innerText="⤬ Delete",u.setAttribute("data-action","mr_list_delete"),u.setAttribute("data-key",e),u.addEventListener("click",h,!0);const m=document.createElement("TD");m.append(d),m.append(u),l.append(m),"append"===n?i.append(l):i.prepend(l)}return{execute:function(){let i=function(e){const t=document.querySelector(".mr-container");t&&"mr-knowledge-base"===t.dataset.action&&e.key&&e.val()&&v(e.key,e.val(),"prepend")};firebase.database().ref("knowledgeBase/").orderByChild("/time").limitToLast(10).on("child_added",i),firebase.database().ref("knowledgeBase/").orderByChild("/time/").limitToLast(10).on("child_changed",i),firebase.database().ref("knowledgeBase/").orderByChild("/time/").on("value",function(i){let s=i.val();const o=document.querySelector(".mr-container");o&&"mr-knowledge-base"===o.dataset.action&&(e=Object.assign({},s),function(){var e=document.getElementById("mr_search_kb"),a=document.getElementById("mr_kb_found"),i=document.getElementById("mr_add_kb");if(e){let t=null,n="";e.addEventListener("click",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.target.value.length>0){var t=document.getElementById("mr_kb_found");t&&(t.style.display="block")}},!0),e.addEventListener("input",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let s=e.target.value;t&&clearTimeout(t),t=setTimeout(function(){""!==s&&n!==s&&(n=s,(async()=>{let e=await m(s);if(e&&a){var t="",n=0;e.forEach(function(e){t+='<li class="mr-kb-row" data-key="'+e.doc.key+'">'+e.doc.que+"</li>",s.toLowerCase().trim()==e.doc.que.toLowerCase().trim()&&(n+=1,i.setAttribute("data-key",e.doc.key),i.setAttribute("data-action","mr_update"),i.innerText="Update")}),n<1&&(i.removeAttribute("data-key"),i.setAttribute("data-action","mr_add"),i.innerText="Add"),a.style.display="block",a.innerHTML=t;var o=document.querySelectorAll(".mr-kb-row");o&&o.forEach(function(e){e.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),p(e.target.dataset.key)},!0)})}})())},1e3)},!0)}i&&i.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var a=t.target.dataset.action;if(a&&"mr_update"===a){var i=t.target.dataset.key;if(""!==i)return p(i)}else if(""!==e.value){var s={que:n(e.value),ans:"",tag:"",time:Date.now()};let t=firebase.database().ref("/knowledgeBase/");t.push(s).then(e=>{if(s.key=e.getKey(),t.child(e.getKey()).set(s),""!==e.getKey())return p(e.getKey())}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})}e.value=""},!0),t.common.mrLoader("body",!1)}(),t.common.mrLoader("body",!1),Date.now()-a>6e4&&(a=Date.now(),firebase.database().ref("actions").child("onlineVisitors").update({lastSync:Date.now(),status:"Knowledge Base"})))}),function(){let t=function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let a,n,i=e,s=Object.keys(i).length,o=parseInt(this.parentNode.dataset.start),r=parseInt(this.parentNode.dataset.end),c=parseInt(this.parentNode.dataset.step);"prev"===this.dataset.type?(a=o-c,n=o):(a=r,n=r+c);let l=a>0?a-1:0,d=n<s?n-1:s-1;if(d<=0||a>=s)return;let u=Object.entries(i).sort((e,t)=>{if(e[1].time&&t[1].time)return t[1].time-e[1].time}).slice(l,d);const m=document.getElementById("mrKnowledgeList");m&&(m.innerHTML="");for(let e=0;u.length>e;e++)if(u[e]){let t=u[e][0];i.hasOwnProperty(t)&&v(t,i[t],"append")}const p=document.querySelector(".mrPagination");p&&(p.dataset.start=l+1,p.dataset.end=d+1,p.dataset.counter=s);const h=document.querySelector(".mrPagiStatus");h&&(h.innerHTML="( "+parseInt(l+1)+" - "+parseInt(d+1)+" ) / "+s)};firebase.database().ref("knowledgeBase/").orderByChild("time/").once("value",function(a){let n=a.val(),i=document.getElementById("mrKnowledgeList"),s=document.getElementById("mrKnowledgeListHead");if(s&&(s.innerHTML='<tr class="vcHeader"></tr><th>Question</th><th>Answer</th><th>More Answer</th><th>Suggestion</th><th>Next Action</th><th>Updated At</th><th>Action</th></tr>'),n){e=Object.assign({},n);let a=Object.keys(n).length;if(a>10){const e=document.createElement("DIV");e.setAttribute("class","mrPagination"),e.setAttribute("data-start",1),e.setAttribute("data-end",11),e.setAttribute("data-counter",a),e.setAttribute("data-step",10);const n=document.createElement("DIV");n.innerText="Prev",n.setAttribute("data-type","prev"),n.addEventListener("click",t,!0);const s=document.createElement("DIV");s.setAttribute("class","mrPagiStatus"),s.innerHTML="(1 - 11) / "+a;const o=document.createElement("DIV");o.innerText="Next",o.setAttribute("data-type","next"),o.addEventListener("click",t,!0),e.append(n),e.append(s),e.append(o),i&&i.parentNode.append(e)}}else i&&(i.innerHTML="No Knowledge Base")})}(),t.trainingIssues.execute(),t.translate.execute()},coreAction:h}}(),e.prototype.settings=function(){let e=document.querySelectorAll("ul#cb-settings-actions > li");function a(e){let a=e+" .mrA_input";firebase.database().ref().child("settings").child("configuration").once("value").then(function(e){e.val()&&t.common.setOptionConfig(a,e.val())}).then(function(){document.querySelectorAll(a).forEach(function(e){e.addEventListener("input",function(e){let n=t.common.getObject(a);firebase.database().ref().child("settings").child(cursor).update(n)})})})}function n(n){n.preventDefault();for(var i=0;i<e.length;i++)e[i].classList.remove("sidebar__menu-item--active");n.currentTarget.classList.add("sidebar__menu-item--active"),n.preventDefault();var s=document.querySelectorAll(".cb-setting");for(i=0;i<s.length;i++)s[i].classList.remove("active");var o=n.target.dataset.id;o||(o=n.target.parentNode.dataset.id);var r=document.querySelector(o);r&&r.classList.add("active"),function(e){let n=document.getElementById("cb-title");"#cbBotConfig"===e||"#cbBotConfigEcommerce"===e?(n.innerText="General Configuration ",a(e)):"#cbSearchEngine"===e?(n.innerText="Chat Bot Configuration ",a(e)):"#cbChatWithVisitors"===e?(n.innerText="Chat With Visitors ",a(e)):"#cbMenus"===e?(n.innerText="Menus ",t.menus.execute(e)):"#cbTranslation"===e?(n.innerText="Translation ",t.translate.settingInit(e)):"#cbHelp"===e&&(n.innerText="Help  ",t.menus.execute(e))}(o)}return{execute:function(){document.querySelector(".mrSettingAuthCheck"),document.querySelector(".aicb-setting"),firebase.auth().onAuthStateChanged(function(i){i&&(function(){e=document.querySelectorAll("ul#cb-settings-actions > li");for(var t=0;t<e.length;t++)e[t].addEventListener("click",n)}(),function(){const e=document.querySelector(".mSettingsMenu");e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelector(".mobile .aicb-setting ul");t&&(t.style.display="block"===t.style.display?"none":"block")},!0)}(),a("#cbBotConfig"),firebase.database().ref("actions").child("onlineVisitors").update({lastSync:Date.now(),status:"Setting"}),t.translate.execute())}),setTimeout(function(){t.common.mrLoader("body",!1)},1e3)}}}(),e.prototype.initializer=function(){let e={};const a=["mr-dashboard","mr-chatbot-settings","mr-knowledge-base","mr-user-profile","mr-chat-history","mr-chatbot-console"];function n(){!function(){document.querySelector(".mr-container");let e=['<div class="logo"><div class="mobile-menu"><span class="iconify" data-icon="entypo:menu"></span></div><img width="200px" src="'+mrAssistantObj.plugin_url+'assets/images/mr-logo.png"/></div>',"<ul>",'<li data-inset="mr-dashboard" class="menu-active"><span class="iconify" data-icon="dashicons:dashboard"></span>'+t.translate.menuTx("Dashboard","_txmenu1")+"</li>",'<li data-inset="mr-chatbot-console"><span class="iconify" data-icon="mdi:view-dashboard-variant"></span> '+t.translate.menuTx("Chat Console","_txmenu2")+"</li>",'<li data-inset="mr-knowledge-base"><span class="iconify" data-icon="bx:bxs-bot"></span>'+t.translate.menuTx("Train BOT","_txmenu4")+"</li>",'<li data-inset="mr-chatbot-settings"><span class="iconify" data-icon="dashicons:admin-settings"></span> '+t.translate.menuTx("Settings","_txmenu5")+"</li>",'<li data-inset="mr-chat-history"><span class="iconify" data-icon="fa-solid:history"></span> '+t.translate.menuTx("Chat History","_txmenu6")+"</li>",'<li data-inset="mr-user-profile"><span class="iconify" data-icon="gridicons:multiple-users"></span> '+t.translate.menuTx("Operators","_txmenu7")+"</li></ul>",'<div class="mr-log-out theme"></div><div class="user-pop" style="display: none;">'+t.translate.menuTx("Howdy Admin","_txmenu8")+"</div>"].join(""),a=document.createElement("DIV");a.setAttribute("class","mr-menu theme"),a.innerHTML=e,document.body.prepend(a)}();const e=document.querySelector(".mr-container"),n=document.querySelectorAll(".mr-menu ul li");n&&n.forEach(function(s){s.addEventListener("click",function(s){s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();let o=s.target.dataset.inset;n.forEach(function(e){e.classList.remove("menu-active")}),s.target.classList.add("menu-active"),""!==o&&a.includes(o)&&(e.dataset.action=o,e.innerHTML="",t.common.mrLoader(".mr-container","append"),i())},!0)}),firebase.auth().onAuthStateChanged(function(e){const a=document.querySelector(".user-pop"),n=document.querySelector(".mr-log-out");if(n&&n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),a&&(a.style.display="none"===a.style.display?"flex":"none")},!0),e){let i=mrAssistantObj.plugin_url+"assets/images/boy.svg",s=Math.floor(92344567*Math.random()+6);if(n&&(n.innerHTML=`<img id="mrImg-${s}" src="${e.photoURL}"/>`,t.common.image(s,e.photoURL,i,"imgSrc")),a){a.innerHTML=`<img id="mrImg-${s+9}" src="${e.photoURL}"/>`,t.common.image(s+9,e.photoURL,i,"imgSrc");let n=document.createElement("H2");n.innerText=e.displayName||"Admin",a.appendChild(n);let o=document.createElement("BUTTON");o.innerText="Sign Out",o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),firebase.auth().signOut()},!0),a.appendChild(o)}}else a&&(a.innerHTML=""),o()}),function(){const e=document.querySelector(".mobile-menu");e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelector(".mobile .mr-menu ul");t&&(t.style.display="flex"===t.style.display?"none":"flex")},!0)}()}function i(){const e=document.querySelector(".mr-container");if(e){const n=e.dataset.action;""!==n&&a.includes(n)&&(e.innerHTML=t.templateDom.execute(n),t.common.mrLoader(".mr-container","append"),"mr-dashboard"===n&&setTimeout(t.dashboard.execute(),1e3),"mr-chatbot-console"===n&&t.livechat_admin.execute(),"mr-chatbot-settings"===n&&setTimeout(t.settings.execute(),1e3),"mr-knowledge-base"===n&&setTimeout(t.knowledgeBase.execute(),1e3),"mr-user-profile"===n&&setTimeout(t.userProfile.execute(),1e3),"mr-chat-history"===n&&setTimeout(t.chat_history.execute(),1e3))}}function s(e,t="OK"){const a=document.querySelector(".mr-container"),n=document.querySelectorAll(".mrPopBox");n&&n.forEach(e=>e.remove());let i=document.createElement("DIV"),s=document.createElement("P");s.innerHTML=e;let o=document.createElement("SPAN");o.innerText=t,o.addEventListener("click",function(e){const t=document.querySelectorAll(".mrPopBox");t&&t.forEach(e=>e.remove())},!0),i.setAttribute("class","mrPopBox theme"),i.append(s),i.append(o),a&&a.prepend(i)}function o(){let e=document.querySelector(".mr-menu");e&&e.remove();var a=['<div class=" mr-pre-chat wrapper" >','<div class=" container">','<div class="mr-center-box"> ','<div class="mr-login-form cb-column">',"<h4>Mr. Assistant</h4>",'<button id="googleLogin" class="btn"><span class="iconify" data-icon="logos:google-icon"></span> Sign in with Google</button>','<div class="mrError"></div>',"</div>","</div>","</div>","</div>"].join("");document.querySelector(".mr-container").innerHTML=a,t.common.mrLoader("body",!1),setTimeout(function(){let e=document.querySelector("#googleLogin");e&&e.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),function(){const e=new firebase.auth.GoogleAuthProvider;firebase.auth().signInWithPopup(e).then(function(e){"on"===mrAssistantObj.dev&&console.log(e);const t=e.user,a=t.email;if(t.uid&&a){let e={uid:t.uid,name:t.displayName||"Admin",email:a,avatar:t.photoURL,creationTime:Date.now(),lastSignInTime:Date.now()};return firebase.database().ref("users").child(t.uid).once("value",function(a){let n=a.val();"on"===mrAssistantObj.dev&&console.log("Mr Users -> ",n),n?(firebase.database().ref("users").child(t.uid).update({lastSignInTime:Date.now()}),n.access?s("Thank You!!"):firebase.auth().signOut().then(function(){s("Sorry!! You have been blocked by Admin. Please contact Admin.")},function(e){"on"===mrAssistantObj.dev&&console.info(e)})):(e.access=!0,firebase.database().ref("users").child(t.uid).update(e).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}))})}}).catch(function(e){let t=document.querySelector(".mrError");if(t){let a="Oops!! Something was Wrong. Please try again.";if(void 0!==e.message)if("string"==typeof e.message)a=e.message;else if("object"==typeof e.message){let t=JSON.parse(e.message);t.error&&t.error.message&&(a=t.error.message)}t.style.display="block",t.innerHTML=a,s(a),"on"===mrAssistantObj.dev&&console.info(e)}})}()},!0)},1e3)}function r(){let e=document.querySelector(".mr-menu");e&&e.remove();const a=['<div class=" mr-pre-chat wrapper" >','<div class=" container"> ','<div class="mr-center-box">','<div class="mr-login-form cb-column">',"<h4>Firebase Configuration</h4>","<p>Need to Configuration Firebase realtime Database to use Mr. Assistant Control panel App.</p>",'<button type="button" id="superLogin" class="btn">Configure here</button>',"<p></p>","</div>","</div>","</div>","</div>"].join("");document.querySelector(".mr-container").innerHTML=a,t.common.mrLoader("body",!1),setTimeout(function(){let e=document.querySelector("#superLogin");e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=new URL(window.location.href),a=new window.URLSearchParams(window.location.search);a.set("page","mr-assistant-setting"),t.search=a,localStorage.setItem("mrActiveTab","#mr_assistant_realtime_database"),window.open(t.toString())},!0)},1e3)}function c(e){const t=document.getElementById("mr_config_script");if(t&&e){let a=e.hasOwnProperty("configuration")?e.configuration:{};t.innerHTML="let mrAssets ="+JSON.stringify(a)}}function l(){firebase.database().ref("users").once("value",function(e){let t=e.val();const a=document.getElementById("mr_user_config");if(t&&a){let e={};Object.keys(t).forEach(function(a){let n=t[a],i={};i.uid=a,i.name=n.hasOwnProperty("name")?n.name:"Admin",i.avatar=n.hasOwnProperty("avatar")?n.avatar:"",e[a]=i}),a.innerHTML="let mrUserAssets ="+JSON.stringify(e)}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})}return{execute:function(){try{if(function(e){const t=document.getElementById("mr_bot_config");t&&e&&(t.innerHTML="let mrBot ="+JSON.stringify(e))}(e=Object.assign({},mrAssistantObj)),0===firebase.apps.length){const e={apiKey:mrAssistantObj.web_api_key,authDomain:mrAssistantObj.project_id+".firebaseapp.com",databaseURL:"https://"+mrAssistantObj.project_id+".firebaseio.com",storageBucket:mrAssistantObj.project_id+".appspot.com"};firebase.initializeApp(e)}firebase.apps.length>0?firebase.auth().onAuthStateChanged(function(e){var t;e?(firebase.database().ref("actions").child("online").update({lastSeen:Date.now(),status:"online"}),function(e){if(!e.email||e.isAnonymous){let t=firebase.database().ref("clients").child(e.uid);t.child("info").child("name").once("value",function(e){let a=e.val();t.child("info").update({isAdminUser:!0,name:(a||"")+" (Admin)",lastSeen:Date.now(),session:"Session Destroy by Admin"}).then(function(){var e=firebase.auth().currentUser;return e.isAnonymous&&(localStorage.setItem("mrAssistantChatItself",!0),e.delete().then(function(){return o()})),s("Hey!! It's Admin Section. Your Current Chat session have been deleted. Now you need to login as Admin."),o()})})}else localStorage.setItem("mrAssistantChatItself",!1)}(e),t=document.querySelector("body"),["Android","webOS","iPhone","iPad","iPod","BlackBerry","Windows Phone"].some(e=>navigator.userAgent.match(new RegExp(e,"i")))?(t.classList.add("mobile"),t.classList.remove("desktop"),window.frameElement.style.width="100%"):(t.classList.remove("mobile"),t.classList.add("desktop")),n(),i(),firebase.database().ref("settings").once("value",function(e){let t=e.val();t&&t.hasOwnProperty("configuration")?(c(t),l()):function(){let e=mrAssistantObj.plugin_url;firebase.database().ref("knowledgeBase").once("value",function(t){t.val()||axios.get(e+"assets/database/knowledgeBase.json").then(function(e){let t=e.data;t&&firebase.database().ref("knowledgeBase").update(t).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})})}).then(function(){axios.get(e+"assets/database/settings.json").then(function(e){let t=e.data;try{t&&(c(t),l(),firebase.database().ref("settings").update(t.settings),firebase.database().ref("menus").update(t.menus),firebase.database().ref("help").update(t.help),firebase.database().ref("translation").update(t.translation).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}))}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}})})}()}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})):o()}):r()}catch(e){r()}},settings:e,menuInit:function(e=""){const t=document.querySelector(".mr-container");if(t&&""!==e&&a.includes(e)){t.dataset.action=e;const a=document.querySelectorAll(".mr-menu ul li");return a&&a.forEach(t=>{t.classList.remove("menu-active"),t.dataset.inset===e&&t.classList.add("menu-active")}),i()}},menuExecute:i,addUserToScript:l,popMessage:s}}(),e.prototype.connector=function(){return{execute:function(){try{let e=document.body.dataset.action;if(document.body.dataset.token,"mr-assistant-chatbot"!==e)return 0;t.initializer.execute()}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}}}}(),document.addEventListener("readystatechange",t=>{if("complete"===t.target.readyState){(new e).connector.execute()}})}();