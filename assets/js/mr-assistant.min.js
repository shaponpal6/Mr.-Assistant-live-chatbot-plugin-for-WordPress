!function(){"use strict";let e=function(){},t=new e;e.prototype.common=function(){function e(e,t=!1){let n=e.split(" ").filter(e=>e).join(" "),a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"/"};t&&(a["/"]="&#x2F;");return n.replace(/[&<>"'\/]/gi,e=>a[e])}function t(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}function n(e){try{let t=localStorage.getItem("mrAssistantSounds");if(t&&"mute"===t)return;let n=document.getElementById(e);if(n){let e=n.play();void 0!==e&&e.catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})}}catch(e){}}async function a(e,t,n,a="bg",o=""){await new Promise(e=>{const a=new Image;a.src=t,a.onload=(()=>e(t)),a.onerror=(()=>e(n))}).then(function(n){if(n===t)return;let s=document.getElementById("mrImg-"+e);s&&("img"===a?s.innerHTML='<img width="'+o+'" src="'+n+'"/>':"imgSrc"===a?s.src=n:s.style.backgroundImage="url("+n+")")})}return{timeDiffSeconds:function(e,t=Date.now()){if(e=parseInt(e),t=parseInt(t),e&&t)return(t>e?t-e:e-t)/1e3;return 0},generateGUID:function(){return"xxxsxxxxxhxxxxayxpxxxxxxoxxxyyxxnxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getBrowser:function(){const e=function(e){return e.test(window.navigator.userAgent)};switch(!0){case e(/edge/i):return"Microsoft Edge";case e(/opr/i)&&(!!window.opr||!!window.opera):return"Opera";case e(/chrome/i)&&!!window.chrome:return"Google Chrome";case e(/trident/i):return"Internet Explorer";case e(/firefox/i):return"Mozilla Firefox";case e(/safari/i):return"Safari";default:return"unknown"}},whiteSpaces:function(t){return e(t)},sanitize:e,getUrlPath:function(e="",t="path"){let n=new URL(""!==e?e:document.location.href);return"domain"===t?n.origin:"path"===t?n.pathname:void 0},playSound:n,getObject:function(e){const t=document.querySelectorAll(e);let n={};for(let e=0;e<t.length;e++){const a=t[e].dataset.action,o=t[e].dataset.key;if("text"===a&&(n[o]=t[e].value),"checkbox"===a&&(n[o]=1==t[e].checked?1:0),"select"===a&&(n[o]=t[e].options[t[e].selectedIndex].value),"radio"===a){const a=t[e].querySelector("input[name="+o+"]:checked");n[o]=a?a.value:"1"}}return n},setCookie:function(e,t,n={expires:1,path:"/",domain:window.location.hostname,secure:!0}){return Cookies.set(e,t,{expires:n.exp,path:n.path,domain:n.domain,secure:n.secure})},getCookie:function(e,t={expires:1,path:"/",domain:window.location.hostname,secure:!0}){return Cookies.get(e,{expires:t.exp,path:t.path,domain:t.domain,secure:t.secure})},getDateTime:function(e){let t=new Date(e),n=function(e){return t.getHours()>12?e?t.getHours()-12:" PM":e?t.getHours():" AM"};return t.getDate()+" "+["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][t.getMonth()+1]+" AT "+n(!0)+":"+t.getMinutes()+n(!1)},loaderText:function(){return'<div class="single-item mr-spinner-full"><div class="mr-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div></div>'},mrLoader:function(e=!1){const t=document.querySelectorAll(".mr-spinner");t&&t.forEach(e=>e.remove());const n=document.createElement("DIV");n.setAttribute("class","mr-spinner"),n.innerHTML='<div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div>';let a=document.getElementById("cbMessages");e&&a&&(a.appendChild(n),a.scrollIntoView({behavior:"smooth",block:"end"}))},typeLoader:function(e=!1){const o=document.querySelectorAll(".tp-wrapper");o&&o.forEach(e=>e.remove());let s=mrAssistantObj.plugin_url+"assets/images/mr-assistant.svg",i=mrAssistantObj.hasOwnProperty("avatar")&&t(mrAssistantObj.avatar)?mrAssistantObj.avatar:s;const r=document.createElement("DIV");r.setAttribute("class","tp-wrapper fade");let c=Math.floor(92992343*Math.random()+1);r.innerHTML=`<img id="mrImg-${c}" src="${i}" class="avatar"/><div class="tp-container"><div class="tp-balls"><span></span><span></span><span></span></div></div>`;const l=document.getElementById("cbMessages");e&&l&&(n("au-typing"),l.appendChild(r),a(c,i,s,"imgSrc",25)),l&&l.scrollIntoView({behavior:"smooth",block:"end"})},localDB:function(e,t,n={},a=!1){let o=[];try{let t=JSON.parse(localStorage.getItem(e));t&&t.length>0&&t.forEach(e=>o.push(e))}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}return"get"===t?o:"set"===t?(a&&(o=[]),o.push(n),localStorage.setItem(e,JSON.stringify(o))):void 0},getRandomInt:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e},jsonParse:function(e){try{if(void 0!==e)return JSON.parse(e)}catch(e){return!1}return!1},isValidURL:t,image:a,isset:function(e){try{return void 0!==e}catch(e){return!1}},timeAgo:function(e,t=""){const n=new Date(e),a=new Date-n,o=Math.floor(a/864e5),s=Math.floor(a%864e5/36e5),i=Math.round(a%864e5%36e5/6e4);return"min"===t?i:o>0?o>1?o+" days ago":o+" day ago":s>0?s>1?s+" hours ago ":s+" hour ago":i>0?i>1?i+" mins ago ":i+" min ago":n.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})}}}(),e.prototype.conn=function(){let e,n,a="",o={},s="",i={},r=null;function c(e){e&&(firebase.database().ref("clients").child(e.uid).child("settings").on("value",function(e){try{let t=e.val();t&&(n=Object.assign({},t)),t&&t.hasOwnProperty("block")&&localStorage.setItem("mrAssistantBlock",t.block),t&&t.hasOwnProperty("mrSupport")&&localStorage.setItem("mrAssistantSupport",t.mrSupport)}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}}),firebase.database().ref("clients").child(e.uid).child("actions").on("child_added",function(n){t.common.typeLoader(!1);let a=n.key,o=n.val();if(o){let n=o.actionType,s=o.actionName,i=o.status,r=o.time;if("pending"!==i)return;t.common.timeDiffSeconds(r)<=10?firebase.database().ref("clients").child(e.uid).child("actions").child(a).update({status:"Executed"}).then(function(){"expend"!==localStorage.getItem("mrAssistantDom")&&t.init.chat_start()}).then(function(){if(t.common.setCookie("mrRobotAutoAction",0,5),t.common.setCookie("mrRobotSession",t.common.generateGUID(),5),"survey"===n&&"signUp"===s)t.form.surveyForm(s);else if("search"===n&&""!==o.subAction)if("redirect"===o.subAction)try{new URL(s);t.init.popMessage({title:t.translate.get("Suggestion","_txcwpm21"),content:t.translate.get("You have suggestion. You can click on this button to view.","_txcwpm22"),type:"redirect",button:t.translate.get("View Now","_txcwpm23"),action:s}),f(t.translate.get("Admin has suggested for this page.","_txcwpm12"))}catch(t){firebase.database().ref("clients").child(e.uid).child("actions").child(a).update({status:"Dropped"})}else"kb"===o.subAction&&t.controller.bot(s,{kbAction:1});else if("help"===n&&"HelpMenu"===s)t.init.mrHelpMenuExecute(null);else if("feedback"===n&&"Feedback"===s)t.form.feedbackForm(s);else if("menuAction"===n&&"menuAction"===s){const e=document.querySelector(".mr_menus");e&&e.click()}else if("botStatus"===s){let e=document.querySelector(".cb_bot");e&&e.click()}else"endChat"===s?m():firebase.database().ref("clients").child(e.uid).child("actions").child(a).update({status:"Dropped"});t.common.typeLoader(!1)}):firebase.database().ref("clients").child(e.uid).child("actions").child(a).update({status:"Dropped"})}}))}function l(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let n=e.target.parentNode,a=document.querySelectorAll(".mr_action_btn");if(n.classList.contains("mr_action_btn")){let e=n.dataset.action;if("signin"===e)u();else if("signout"===e)m();else if("rateChat"===e)t.form.feedbackForm("feedback");else if("pausedBot"===e){const e=document.querySelector(".cb_bot");if(e){document.getElementById("menuBotStatus");e.click()}}else"muteSounds"===e?(localStorage.setItem("mrAssistantSounds","mute"),a&&a.forEach(function(e){let t=e.dataset.action;t&&"playSounds"===t&&(e.style.display="flex"),t&&"muteSounds"===t&&(e.style.display="none")})):"playSounds"===e&&(localStorage.setItem("mrAssistantSounds","play"),a&&a.forEach(function(e){let t=e.dataset.action;t&&"playSounds"===t&&(e.style.display="none"),t&&"muteSounds"===t&&(e.style.display="flex")}))}}function m(){const e=firebase.auth().currentUser;e?e.delete().then(function(){window.frames.location.reload()}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e),f(t.translate.get(e.message,"_txcwsi201"))}):f(t.translate.get("Please introduce yourself","_txcwsi1"))}function u(){return t.form.surveyForm("signUp")}function d(e){const t=document.getElementById("mr_user_config");let n=[];e&&Object.keys(e).forEach(function(t){let a=e[t];n[t]={name:a.name||"Anonymous",avatar:a.avatar||""}}),t&&(t.innerHTML="let mrUsers ="+JSON.stringify(Object.assign({},n)))}function p(){firebase.auth().onAuthStateChanged(function(e){if(!e)return;let n=firebase.database().ref("clients").child(e.uid);n.child("info").on("value",function(e){let a=e.val();if(a.name&&(i=Object.assign(i,{clientName:a.name})),!a||!a.marge){const e=firebase.auth().currentUser;let a={isNewUser:!0,marge:!0,domain:window.location.hostname,lastSeen:Date.now(),join:Date.now()};n.child("info").update(a),n.child("settings").update({archive:"unarchived",block:"unblock",mrSupport:"on",kbSupport:"on",status:"active",uEndChat:"start"});let o=mrAssistantObj.hasOwnProperty("name")&&""!==mrAssistantObj.name?mrAssistantObj.name:"Mr. Assistant",s=mrAssistantObj.hasOwnProperty("avatar")&&t.common.isValidURL(mrAssistantObj.avatar)?mrAssistantObj.avatar:"",i=mrAssistantObj.hasOwnProperty("mrAssistantBot")&&"on"!==mrAssistantObj.mrAssistantBot?"pulse":"active";n.child("conversation").child("mr-assistant").update({name:o,avatar:s,join:Date.now(),type:"bot",status:i}).then(function(){firebase.database().ref("actions").child("visitorSignUp").child(e.uid).remove()})}}),n.child("conversation").on("value",function(e){let n=e.val();if(n)try{d(n),t.common.setCookie("mrUserAssets",JSON.stringify(n));let a=t.template.setAvatar(e.key,n),o=document.querySelector(".mr-left-header");if(o&&(o.innerHTML=a),n.hasOwnProperty("mr-assistant")){const e=document.querySelector(".bot-line"),a=document.querySelector(".cb_bot");if(e&&a){"active"===n["mr-assistant"].status?(e.style.display="none",a.dataset.action="running",a.classList.remove("bot-pulse"),f(t.translate.get("Support bot is activated. Now you can search & chat..","_txcwbs1"))):(e.style.display="inline",a.dataset.action="pulse",a.classList.add("bot-pulse"),f(t.translate.get("Support bot is deactivated. Sending to Live Agent.","_txcwbs2")))}}}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}else d({})}),e.email&&firebase.database().ref("users").once("value",function(a){let o=a.val();o&&Object.keys(o).forEach(function(a){if(o.hasOwnProperty(a)){let s=o[a];if(e.email===s.email){let a=""!==s.name?s.name+" (Admin)":"You (Admin)";n.child("info").update({join:Date.now(),isAdminUser:!0,marge:!0,name:a,email:s.email}),firebase.database().ref("livechat/").child(e.uid).set(""),firebase.database().ref("browses/").child(e.uid).set(""),firebase.database().ref("clients").child(e.uid).child("actions").set(""),f(`${t.translate.get("Hello ","_txcwkw_hello")} ${a},  ${t.translate.get("You are chatting itself.","_txcwis1")}`)}}})}),firebase.database().ref("mr-assistant").child("name").on("value",function(e){e.val()&&(i=Object.assign(i,{mrAssistant:e.val()}))})})}function f(e){A(e,!0,!0)}function h(n){if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),null!==firebase.auth().currentUser){const a=firebase.auth().currentUser.uid;firebase.database().ref("livechat").child(a).once("value",function(a){let o=a.val();if(!o)return;let s,i=Object.entries(o),r=i.length||0,c=parseInt(n.target.dataset.step),l=parseInt(n.target.dataset.inset),m=(parseInt(n.target.dataset.counter),l+c),u=r-l,d=u-c>0?u-c:0,p=i.slice(d,u);for(s=p.length;s>=0;s--)if(p[s]){let n=p[s][0];o.hasOwnProperty(n)&&t.template.templateDark(n,o[n],e,"prepend")}n.target.dataset.inset=m,n.target.style.display=r>m?"block":"none"})}}function g(n){const a=document.querySelector(".cbMessages");if(a&&(a.innerHTML=""),n){t.common.mrLoader(!0);const a=function(n){let a=n.val();Date.now()-a.time<2e3&&t.common.playSound("au-message"),t.template.templateDark(n.key,a,e),v(a.text)};firebase.database().ref("livechat").child(n.uid).limitToLast(20).on("child_added",a),firebase.database().ref("livechat/").child(n.uid).once("value",function(e){let t=e.numChildren(),n=document.querySelector(".loadMore");t>20&&(n.dataset.inset=20,n.dataset.step=10,n.dataset.counter=t,n.style.display="block",n.addEventListener("click",h,!0))}),t.common.mrLoader(!1)}else try{let n=t.common.localDB("mrAssistantOfflineChat","get");n&&n.length>0&&n.forEach(function(n){return t.template.templateDark("offline-"+Math.floor(Math.random()*Math.floor(Date.now())),n,e)})}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}}function b(e,n,a){let o={type:a,name:n?n.displayName:"Anonymous",text:e,time:Date.now()};if(!n)return t.common.localDB("mrAssistantOfflineChat","set",o),t.template.templateDark("offline-"+Date.now(),o,"message-visitor");i&&("client"===a?o.name=i.clientName||"Anonymous":"bot"===a&&(o.name=i.mrAssistant||"Mr. Assistant")),firebase.database().ref("livechat").child(n.uid).push(o).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}),firebase.database().ref("clients").child(n.uid).child("info").update({lastMessage:e.substring(0,20),lastSeen:Date.now()})}function y(o,s){const i=document.getElementById("mr_sender"),r=document.getElementById("message");let c=null;i&&r&&r.addEventListener("keyup",function(e){13===e.keyCode&&i.click()}),i&&i.addEventListener("click",function(s){if(e.configuration&&"chatOffline"!==e.configuration.chatWay&&n&&"block"===n.block)return A("Oops!! Something happen wrong. Contact to Admin.",!0,!0);s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();let i=t.common.whiteSpaces(r.value);c&&clearTimeout(c),c=setTimeout(function(){""!==i&&(r.value="",(async()=>{try{let n=localStorage.getItem("mrAssistantBlock");if(n&&"block"===n)return"";if(t.common.playSound("au-message"),mrAssistantObj.hasOwnProperty("cmd")&&"on"===mrAssistantObj.cmd&&"-mr"===i.toLowerCase().replace(/ .*/,""))return a=i,t.controller.mrCommandLine(i);if(o)return function(e,t){if(!e)return;const n=firebase.database().ref().child("clients").child(e.uid);n.child("/info/lastMessage").set(t),n.child("/info/lastSeen").set(Date.now()),n.child("/info/unread").transaction(function(e){return(e||0)+1})}(o,i),a=i,b(i,o,"client");if("chatOffline"===e.configuration.chatWay)return a=i,b(i,o,"client"),await v(i);"chatAnonymously"===e.configuration.chatWay?t.form.signUp({signUp:"Anonymously"},"",!0):u()}catch(e){A("Oops!! Wrong Configuration!!",!0,!0),"on"===mrAssistantObj.dev&&console.info(e)}})())},100)})}const v=async function(s){a===s&&(r&&clearTimeout(r),r=setTimeout(async function(){if("off"!==mrAssistantObj.mrAssistantBot&&e.configuration.assistantSupport){if("chatOffline"!==e.configuration.chatWay&&"active"===n.status){t.common.typeLoader(!0),o.kbAction=!("on"!==n.kbSupport||!e.configuration.kbBot);let a=Object.assign({},o,e);t.common.setCookie("mrRobotAutoAction",0,5),t.common.setCookie("mrRobotSession",t.common.generateGUID(),5);let i=localStorage.getItem("mrAssistantSupport");return i&&"off"===i?t.common.typeLoader(!1):await t.controller.bot(s,a)}if("chatOffline"===e.configuration.chatWay){t.common.typeLoader(!0),o.kbAction=!!e.configuration.kbBot;let n=Object.assign({},o,e.configuration);return t.common.setCookie("mrRobotAutoAction",0,5),t.common.setCookie("mrRobotSession",t.common.generateGUID(),5),await t.controller.bot(s,n)}}else t.common.typeLoader(!1)},100))};function A(e,t,n=!1){let a=document.querySelector(".mr_status_box");if(!a)return;let o=document.createElement("DIV");o.setAttribute("class","mr_status theme"),o.innerHTML=e,a.style.display=t?"flex":"none",a.innerHTML="",a.append(o),n&&setTimeout(function(e){o.innerHTML=s,a.innerHTML="",a.append(o)},5e3)}return{execute:function(){firebase.auth().onAuthStateChanged(function(n){a="",n?firebase.database().ref("settings").once("value",function(t){let n=t.val();n&&(e=Object.assign({},n))}).then(function(){y(n),c(n),p(),t.translate.execute()}).then(function(){setTimeout(function(){g(n)},1e3)}):firebase.database().ref("settings").once("value",function(a){try{e=Object.assign({},a.val());let o=Object.assign({},e.configuration?e.configuration:{});if(o.chatWay)switch(o.chatWay){case"chatWithVisitor":t.form.surveyForm("signUp");break;case"chatAnonymously":!function(e=!0){let n={name:t.common.getRandomInt(1e3,9999),email:"",isNewUser:!1,marge:!1,lastSeen:Date.now(),method:"signInAnonymously",type:"liveChat",chatWay:"signInAnonymously",join:Date.now(),status:"active",currentPage:window.location.href,browser:t.common.getBrowser(),language:navigator.languages.join(","),platform:navigator.platform};localStorage.getItem("mrAssistantChatItself")||firebase.auth().signInAnonymously().then(e=>{var a=e.user;a&&(n.uid=a.uid,n.method="signInAnonymously",firebase.database().ref("clients").child(a.uid).child("info").update(n),A(t.translate.get("Welcome!! Now You can search or chat..","_txcwsc1"),!0,!0))}).catch(function(e){A(t.translate.get("Oops!! Something went wrong. Try again!!","_txcwsc2"),!0,!0),"on"===mrAssistantObj.dev&&console.info(e)})}(o.uniqueAnonymous);break;case"chatWithEmail":t.form.surveyForm("signUp");break;case"chatOffline":d({}),y(n);break;default:t.form.surveyForm("signUp")}t.translate.execute()}catch(e){A(t.translate.get("Oops!! Something went wrong. Try again!!","_txcwsc2"),!0,!0),"on"===mrAssistantObj.dev&&console.info(e)}}),A(s=mrAssistantObj.offline_text||" ",!0,!1),firebase.database().ref("actions").child("online").on("value",function(e){let n=e.val();if(n.hasOwnProperty("lastSeen")&&n.hasOwnProperty("status")){let e=t.common.timeDiffSeconds(n.lastSeen);"online"===n.status&&e<600?mrAssistantObj.hasOwnProperty("online_text")&&(s=mrAssistantObj.online_text):mrAssistantObj.hasOwnProperty("offline_text")&&(s=mrAssistantObj.offline_text),A(s,!0,!1)}}),firebase.auth().onAuthStateChanged(function(e){const t=document.querySelector(".mr-dropdown");if(t){t.innerHTML="";let n=function(e,n,a,o="",s="flex"){let i=document.createElement("P");i.setAttribute("class","mr_action_btn"),i.setAttribute("style","display: "+s),i.setAttribute("data-action",n),i.addEventListener("click",l,!0);let r=""!==a?a:"bpmn:start-event-parallel-multiple";i.innerHTML=`<span class="iconify mr-svg" data-icon="${r}" data-inline="true"></span><span id="${o}">${e}</span>`,t&&t.appendChild(i)};n("Chat Bot","pausedBot","ant-design:robot-filled","menuBotStatus");let a=localStorage.getItem("mrAssistantSounds"),o=a&&"mute"===a?"none":"flex";n("Enable Sounds","playSounds","si-glyph:sound-mute","playSounds",a&&"mute"===a?"flex":"none"),n("Mute Sounds","muteSounds","subway:sound","muteSounds",o),e?(n("Rate for this chat","rateChat","vaadin:star-half-left-o"),n("End Chat","signout","mdi-light:logout")):n("Start Chat","signin","ant-design:login-outlined")}})})},clear:function(){return c(null),p(),g(null),y(null),""},_conversationInit:p,notification:f,setMessages:b,chatUsers:i}}(),e.prototype.init=function(){let n={},a=0;function o(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let n=e.target.parentNode.dataset.key;const a=document.querySelector(".alc_pop_box"),o=window.frameElement;n&&firebase.database().ref().child("/menus/").child(n).once("value").then(function(e){let n=e.val(),s=document.querySelector(".introMessage");s&&s.remove(),o.style.width="100%",o.style.height="100vh",a.innerHTML=t.common.loaderText(),a.innerHTML=t.template.menuView("menu",n)}).then(function(){let e=document.querySelector(".close_btn");e&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),a.innerHTML="",o.style.width="430px",o.style.height="100vh"},!0)})}function s(e){let n=e.target.dataset.type,a=e.target.dataset.action;if("redirect"===n){new URL(a);let e=window.open(a,"_blank");if(e&&!e.closed&&void 0!==e.closed)return e.focus();t.conn.notification(t.translate.get("Pop-up Blocked.","_txcwrn2"))}}function i(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.common.mrLoader(!0);let n=document.createElement("DIV");const a=document.querySelector("#cbBotMessages"),s=mrAssistantObj.plugin_url+"assets/images/menu.svg";let i=function(e){if(t.common.isValidURL(e))return`<img src="${e}"/>`;{let t=e.match(/<span[^>]*>[^>]*<\/span>/g);return t&&t[0]?t[0]:`<img src="${s}"/>`}};firebase.database().ref().child("/menus/").once("value").then(function(e){n.setAttribute("class","viewCart");let a="",o=e.val();if(a+=`<div class="cart-header theme"><div class="cart-title">${t.translate.get("My Menu","_txcwMenu1")}</div>`+'<span class="close-cart-view">X</span></div>',o){let e,t="";for(e in o)if(o.hasOwnProperty(e)){o[e].menuUrl;t+=`<li class="mr-menu-item" data-key="${o[e].menuID}">${i(o[e].menuUrl)}<h4 class="menu-title">${o[e].menuName}</h4></li>`}a+='<ul class="menu-list">',a+=t,a+="</ul>"}else a+=`<div>${t.translate.get("No Menu","_txcwMenu1")}</div>`;n.innerHTML=a}).then(function(){const e=document.querySelectorAll(".viewCart");e&&e.forEach(function(e){e.remove()}),document.querySelector("#cbMessages").append(n),a.querySelectorAll(".mr-loader").forEach(function(e){e.style.display="none"});let t=document.getElementById("cbMessages");t&&t.childNodes.length>2&&t.scrollIntoView({behavior:"smooth",block:"end"});let o=document.querySelector(".viewCart .close-cart-view");o&&o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelectorAll(".viewCart");t&&t.forEach(e=>e.remove())},!0)}).then(function(){let e=document.querySelectorAll(".menu-list .mr-menu-item");e&&e.forEach(e=>e.addEventListener("click",o,!0))}),t.common.mrLoader(!1),t.common.typeLoader(!1)}function r(e){e&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),t.common.mrLoader(!0);let n=document.createElement("DIV");const a=document.querySelector("#cbBotMessages");firebase.database().ref().child("/help/").once("value").then(function(e){n.setAttribute("class","viewCart");let t="",a=e.val();if(a&&a.hasOwnProperty("helpContent")){t+=`<div class="cart-header theme"><div class="cart-title">${a.helpTitle&&""!==a.helpTitle?a.helpTitle:"Help"}</div><span class="close-cart-view">X</span></div>`,t+='<div class="help-content">',t+=a.helpContent&&""!==a.helpContent?a.helpContent:"",t+="</div>"}else t+="<div></div>";n.innerHTML=t}).then(function(){const e=document.querySelectorAll(".viewCart");e&&e.forEach(e=>e.remove()),document.querySelector("#cbMessages").append(n),a.querySelectorAll(".mr-loader").forEach(e=>e.style.display="none");let t=document.getElementById("cbMessages");t&&t.scrollIntoView({behavior:"smooth",block:"end"});let o=document.querySelector(".viewCart .close-cart-view");o&&o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelectorAll(".viewCart");t&&t.forEach(e=>e.remove())},!0)}).then(function(){let e=document.querySelectorAll(".menu-list .mr-menu-item");e&&e.forEach(e=>e.addEventListener("click",o,!0))}),t.common.mrLoader(!1),t.common.typeLoader(!1)}function c(){!function(){const e=document.querySelector(".alc_chatbot");let n=document.querySelector(".close-chat"),a=window.frameElement;a.style.width="430px",a.style.height="100vh";let o=document.querySelectorAll(".tempBox");o&&o.forEach(e=>e.remove()),n&&n.addEventListener("click",function(n){let o=document.querySelector("#alc_chat");e&&o&&(o.remove(),a.style.width="112px",a.style.height="140px");let s=document.querySelector(".introMessage");s&&s.remove();const i=document.querySelector(".alc_pop_box");i&&(i.innerHTML=""),localStorage.setItem("mrAssistantDom","close"),t.common.setCookie("mrAssistantDom","close",{path:document.location.pathname}),t.conn.clear()})}(),function(){const e=document.querySelector(".cb_info"),t=document.querySelector(".mr_menus"),n=document.querySelector(".cb_expend"),a=document.querySelector("#message-form"),o=document.querySelector("#cbMessages"),s=document.querySelector(".cb_message_info");n&&n.addEventListener("click",function(a){a.preventDefault(),e&&(e.style.display="block"),t&&(t.style.display="block"),n&&(n.style.display="none")}),a&&a.addEventListener("click",function(a){e&&(e.style.display="none"),n&&(n.style.display="block"),s&&(s.style.display="none"),t&&(t.style.display="none"),o&&(o.style.display="block")})}(),firebase.auth().onAuthStateChanged(function(e){const t=document.querySelector(".mr_menus"),n=document.querySelector(".cb_bot"),a=(document.querySelector(".mr-cart-count"),document.querySelector(".cb_info"));a&&a.addEventListener("click",r,!0),t&&t.addEventListener("click",i,!0),n&&n.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let a=n.dataset.action,o={};const s=document.querySelector(".bot-line");if("pulse"===a?(n.dataset.action="running",n.classList.remove("bot-pulse"),o.status="active",s&&(s.style.display="none")):(n.dataset.action="pulse",n.classList.add("bot-pulse"),o.status="pulse",s&&(s.style.display="inline")),null!=e){let t=firebase.database().ref("clients").child(e.uid);t.child("conversation").child("mr-assistant").update(o),t.child("settings").update(o)}})}),document.querySelector(".mr-dropdown-btn").addEventListener("click",function(e){let t=document.querySelector(".mr-dropdown");t.style.display="none"===t.style.display?"":"none"})}function l(){firebase.auth().onAuthStateChanged(function(e){e?e&&e.uid&&(!function(e){if(!e)return;let n=t.common.getUrlPath(),a={};localStorage.getItem("mrCurrentPage")!==n&&(firebase.database().ref("browses").child(e.uid).push({page:n,time:Date.now()}),a.currentPage=n,localStorage.setItem("mrCurrentPage",n)),a.lastSeen=Date.now(),firebase.database().ref("clients").child(e.uid).child("info").update(a)}(e),firebase.database().ref("livechat").child(e.uid).limitToLast(1).on("child_added",function(e){let o=e.val();localStorage.getItem("mrAssistantDom");if("expend"!==t.common.getCookie("mrAssistantDom",{path:document.location.pathname})){let e=document.querySelector(".alc_chatbot");if(e){let t=window.frameElement;if(t.style.width="430px",t.style.height="60vh",!document.querySelector(".tempBox")){let t=document.createElement("DIV");t.setAttribute("class","chat tempBox"),e.appendChild(t)}!function(e){if("admin"===e.type&&Date.now()-e.time<2e3){let t=document.querySelector(".tempBox"),a=document.querySelector(".introMessage");if(a&&a.remove(),t){t.style.display="inline-flex";let a=document.createElement("DIV"),o=document.createElement("DIV");a.setAttribute("class","tempMessages"),o.setAttribute("class","tempMessage theme"),n.appearance&&n.appearance.theme&&o.setAttribute("style","background: "+n.appearance.theme||""),o.innerHTML=e.text,a.appendChild(o),t.prepend(a);let s=document.querySelector(".tempBox");s&&s.scrollIntoView({behavior:"smooth",block:"end"})}}}(o),a=1}}})):firebase.database().ref("settings").child("configuration").on("value",function(e){let n=e.val();"chatWithVisitors"===n.chatWay&&n.chatWithVisitor&&firebase.database().ref("actions").child("onlineVisitors").once("value",function(e){let a=e.val(),o=t.common.timeAgo(a.lastSync,"min"),s=n.chatWithVisitorWay;if(n.offlineTracking||o<=30){let e={name:"Visitor "+t.common.getRandomInt(1e3,9999),email:"",isNewUser:!1,marge:!1,lastSeen:Date.now(),method:s,type:"visitorChat",chatWay:"chatWithVisitor",join:Date.now(),status:"active",currentPage:window.location.href,browser:t.common.getBrowser(),language:navigator.language,platform:navigator.platform};if("anonymousAuth"===s)o<=30&&firebase.auth().signInAnonymously().then(t=>{let n=t.user;n&&(e.guid="",e.uid=n.uid,e.vChat="initialized",firebase.database().ref("visitors").child(n.uid).update(e),firebase.database().ref("clients").child(n.uid).child("info").update(e),firebase.database().ref("actions/onlineVisitors/unSeen").transaction(function(e){return(e||0)+1}))}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)});else if("anonymousGuidAuth"===s){let n=t.common.localDB("mrAssistantGUID","get");t.common.jsonParse(n[0]);if(!n[0]||!n[0].guid){let n=t.common.generateGUID(),a="Visitor "+t.common.getRandomInt(1e3,9999);t.common.localDB("mrAssistantGUID","set",{guid:n,visitor:a,join:Date.now()},!0),e.name=a,e.join=Date.now(),e.guid=n,e.uid="",e.status="justJoin",firebase.database().ref("visitors").child(n).once("value",function(e){e.key||firebase.database().ref("actions/onlineVisitors/unSeen").transaction(function(e){return(e||0)+1})}),firebase.database().ref("visitors").child(n).update(e)}let a=t.common.localDB("mrAssistantGUID","get");a[0]&&a[0].guid&&(e.name=a[0].visitor,firebase.database().ref("visitors").child(a[0].guid).update(e),firebase.database().ref("actions").child("visitorSignUp").child(a[0].guid).on("value",function(n){let o=n.val();if(o){let n=t.common.timeAgo(o.lastSync,"min");o.guid===a[0].guid&&n<=2&&firebase.auth().signInAnonymously().then(n=>{let o=n.user;o&&(e.guid=a[0].guid,e.uid=o.uid,e.join=a[0].join||Date.now(),e.method=s,firebase.database().ref("clients").child(o.uid).child("info").update(e).then(function(){t.conn._conversationInit(o)}))}).then(function(){e.vChat="initialized",firebase.database().ref("visitors").child(a[0].guid).update(e)}).then(function(){firebase.database().ref("actions").child("visitorSignUp").child(a[0].guid).remove()}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})}}))}}})})})}function m(){return new Promise(function(e,n){const a=document.querySelector(".alc_chatbot");if(!a)return;if(!document.querySelector(".close-chat")){const e=document.createElement("DIV");e.setAttribute("class","chat"),e.setAttribute("id","alc_chat"),e.innerHTML=t.template.chatTemplate(),a.appendChild(e)}e(c())}).then(function(){let n=new e;n.conn&&n.conn.execute(),localStorage.setItem("mrAssistantDom","expend"),t.common.setCookie("mrAssistantDom","expend",{path:document.location.pathname}),document.body.className=document.body.className.replace("no-js","js")})}return{execute:function(){if(function(){let e=document.getElementById("mr_custom_style");if(t.common.isset(mrAssistantObj)&&e){let n="";mrAssistantObj.hasOwnProperty("chat_bg")&&t.common.isValidURL(mrAssistantObj.chat_bg)&&(n+=`#cbBotMessages{background: transparent url(${mrAssistantObj.chat_bg}) center top no-repeat;background-size: cover;}`),e.innerHTML=n}}(),mrAssistantObj.hasOwnProperty("web_api_key")&&mrAssistantObj.hasOwnProperty("project_id"))if(""!==!mrAssistantObj.web_api_key&&""!==!mrAssistantObj.project_id){if(!firebase.apps.length){let e={apiKey:mrAssistantObj.web_api_key,authDomain:mrAssistantObj.project_id+".firebaseapp.com",databaseURL:"https://"+mrAssistantObj.project_id+".firebaseio.com",storageBucket:mrAssistantObj.project_id+".appspot.com"};firebase.initializeApp(e)}firebase.apps.length&&(n=Object.assign({},mrAssistantObj),firebase.database().ref("settings").once("value",function(e){e.val()&&(function(){let e=document.body;if(["Android","webOS","iPhone","iPad","iPod","BlackBerry","Windows Phone"].some(e=>navigator.userAgent.match(new RegExp(e,"i"))))return e.classList.remove("desktop"),e.classList.add("mobile"),window.frameElement.style.width="100%",!0;e.classList.remove("mobile"),e.classList.add("desktop")}(),(n=Object.assign({},n,e.val())).hasOwnProperty("configuration")&&!n.configuration.assistantSupport||(function(e){let t=['<div class="alc_chatbot"><div class="alc_popup"><div class="alc_pop_box"></div></div></div>'].join("\n"),n=document.createElement("DIV");n.setAttribute("class","mr-assistant-container"),n.innerHTML=t,document.body.prepend(n),setTimeout(function(e){window.frameElement.style.opacity=1},1e3)}(),function(e){const t=document.getElementById("mr_config_script");let n={};t&&e&&(n.configuration=e.hasOwnProperty("configuration")?e.configuration:{},t.innerHTML="let mrAssets ="+JSON.stringify(n))}(n),firebase.database().ref("translation").child("chatWidget").once("value",function(e){let t=e.val();if(t){const e=document.getElementById("mr_trans_config");e&&(e.innerHTML="let mrTrans ="+JSON.stringify(t))}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}),function(){const e=document.querySelector(".alc_chatbot");if(!e)return;let a=localStorage.getItem("mrAssistantFlyMeg");if("expend"===localStorage.getItem("mrAssistantDom"))m();else if((!a||"seen"!==a)&&mrAssistantObj.hasOwnProperty("intro")){let a=mrAssistantObj.intro,o=n&&n.hasOwnProperty("name")?n.name:"Mr. Assistant",s=n&&n.hasOwnProperty("avatar")?n.avatar:"",i=mrAssistantObj&&mrAssistantObj.hasOwnProperty("plugin_url")?mrAssistantObj.plugin_url+"assets/images/mr-assistant.svg":"",r=""!==s&&t.common.isValidURL(s)?s:i,c=mrAssistantObj.hasOwnProperty("intro_box_width")?mrAssistantObj.intro_box_width:360;if(""!==a){const n=document.createElement("DIV");n.setAttribute("class","introMessage"),n.setAttribute("style","width: "+c+"px"),n.innerHTML=t.template.flyTemplate(a,o,r),e.appendChild(n);const s=window.frameElement;s.style.width="430px","100vh"!==s.style.height&&(s.style.height="296px");const i=document.querySelector(".message-container");i&&i.addEventListener("click",m);let l=document.querySelector(".close-introMessage");l&&l.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelector(".introMessage");t&&t.remove(),s.style.width="112px",s.style.height="140px",localStorage.setItem("mrAssistantFlyMeg","seen")});let u=document.querySelector(".intro-start-btn");u&&u.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),m()}),t.translate.execute()}}}()))}).then(function(){const e=document.querySelector(".alc_start");e&&e.addEventListener("click",m,!0),l();const n=document.querySelector(".mr-chat-icon");if(n){const e=mrAssistantObj.chat_icon?mrAssistantObj.chat_icon:"",a=mrAssistantObj.plugin_url+"assets/images/chat-button.svg";let o=Math.floor(92992343*Math.random()+1);n.setAttribute("id","mrImg-"+o),t.common.image(o,e,a,"imgSrc")}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)}))}else"on"===mrAssistantObj.dev&&console.info("Oops!!! Wrong Configuration.");else"on"===mrAssistantObj.dev&&console.info("Oops!!! Wrong Configuration.")},settings:n,mrHelpMenuExecute:r,popMessage:function(e={}){t.common.mrLoader(!0);let n=document.createElement("DIV");const a=document.querySelector("#cbBotMessages");new Promise(function(t,a){n.setAttribute("class","viewCart");let o="",s=e;if(s&&s.hasOwnProperty("content")){o+=`<div class="cart-header theme"><div class="cart-title">${s.title&&""!==s.title?s.title:"Message"}</div>\n                    <span class="close-cart-view">X</span></div>`,o+='<div class="help-content"><p>',o+=s.content&&""!==s.content?s.content:"",o+="</p>";let e=s.button&&""!==s.button?s.button:"",t=s.action&&""!==s.action?s.action:"",n=s.type&&""!==s.type?s.type:"";""!==e&&(o+=`<div class="ex_button theme" data-type="${n}" data-action="${t}">${e||"Click here"}</div>`),o+="</div>"}else o+="<div></div>";n.innerHTML=o,t(1)}).then(function(){const e=document.querySelectorAll(".viewCart");e&&e.forEach(e=>e.remove()),document.querySelector("#cbMessages").append(n),a.querySelectorAll(".mr-loader").forEach(e=>e.style.display="none");let t=document.getElementById("cbMessages");t&&t.scrollIntoView({behavior:"smooth",block:"end"});let o=document.querySelector(".viewCart .ex_button");console.log(o),o&&o.addEventListener("click",s,!0);let i=document.querySelector(".viewCart .close-cart-view");i&&i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelectorAll(".viewCart");t&&t.forEach(e=>e.remove())},!0)}).then(function(){let e=document.querySelectorAll(".menu-list .mr-menu-item");e&&e.forEach(e=>e.addEventListener("click",o,!0)),t.common.mrLoader(!1),t.common.typeLoader(!1)})},chatWithVisitor:l,chat_start:m}}(),e.prototype.translate=function(){return{execute:function(){if(!firebase.auth().currentUser)return;const e=document.querySelectorAll(".mrtx");e&&firebase.database().ref("translation").child("chatWidget").once("value",function(t){let n=t.val()||{};if(n||!n){const t=document.getElementById("mr_trans_config");t&&(t.innerHTML="let mrTrans ="+JSON.stringify(n)),e.forEach(function(e){const t=e.innerText,a=e.dataset.key;if(n.hasOwnProperty(a)&&n[a].hasOwnProperty("tx1")&&""!==n[a].tx1)e.innerText=n[a].hasOwnProperty("tx2")&&""!==n[a].tx2?n[a].tx2:t;else{let e={tx1:t,tx2:t};firebase.database().ref("translation").child("chatWidget").child(a).update(e)}})}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})},get:function(e,t){if(mrTrans){if(t&&mrTrans.hasOwnProperty(t)&&mrTrans[t].hasOwnProperty("tx1")&&""!==mrTrans[t].tx1)return mrTrans[t].hasOwnProperty("tx2")&&""!==mrTrans[t].tx2?mrTrans[t].tx2:e;if(firebase.auth().currentUser){let n={tx1:e,tx2:e};firebase.database().ref("translation").child("chatWidget").child(t).update(n)}}return e}}}(),e.prototype.searchEngine=function(e){let n,a={},o=0,s=0,i=1e3,r="",c=0,l="search";function m(){return firebase.auth().currentUser&&firebase.auth().currentUser.uid}function u(e){let t=Object.values(e);return t&&t.length>0?t[Math.floor(Math.random()*t.length)]:""}function d(e,a,o,s){t.common.getCookie("mrRobotSession");if(s!==n)return;if("kb"===e)y(a,"bot",o);else if("rel"===e){t.common.typeLoader(!0);let e=document.querySelectorAll(".mr-tags");e&&e.forEach(e=>e.remove());let n=document.createElement("DIV");n.setAttribute("class","mr-tags");a.forEach(function(e){let t=document.createElement("SPAN");t.setAttribute("class","tag fade theme"),t.setAttribute("data-key",e.key),t.innerText=e.val,t.addEventListener("click",f,!0),n.appendChild(t)});const o=document.getElementById("cbMessages");t.common.playSound("au-message"),t.common.typeLoader(!1),o&&o.appendChild(n)}const i=document.getElementById("cbMessages");i&&i.scrollIntoView({behavior:"smooth",block:"end"})}function p(e){if(l="search",e.hasOwnProperty("ans")&&""!==e.ans||t.common.typeLoader(!1),"kb"===e.type)l="all_KB",t.controller.bot(e.act,{kbAction:1});else if("redirect"===e.type)e.act&&function(e,n){try{let a=new URL(e);t.init.popMessage({title:t.translate.get("Page Suggestion","_txcwpm1"),content:t.translate.get("Click this button to open this page.","_txcwpm2")+"<p>"+e+"</p>",type:"redirect",button:t.translate.get("Open Page","_txcwpm3"),action:e});let o=window.open(a,"_blank");if(o&&!o.closed&&void 0!==o.closed)return o.focus();t.conn.notification(t.translate.get("Pop-up Blocked. Click this button to open this page.","_txcwrn1"))}catch(e){firebase.database().ref("training").push({uid:m(),time:Date.now(),type:"URL",sts:1,qs:"KB action fail. KB: "+n})}}(e.act,e.que);else if("help"===e.type){const e=document.querySelector(".cb_info");e&&e.click()}else if("menu"===e.type){const e=document.querySelector(".mr_menus");e&&e.click()}else"rate"===e.type&&t.form.feedbackForm("feedback");return""}function f(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a=e.target.innerText,o=e.target.dataset.key;y(a,"client",n);let s=t.common.generateGUID();t.common.setCookie("mrRobotAutoAction",0,5),t.common.setCookie("mrRobotSession",s,5),firebase.database().ref("knowledgeBase").child(o).once("value",function(e){let t=e.val();t&&p(t)})}function h(e){let a=[];return y((a="botConfusion"===e?[t.translate.get("Just splendid, thanks","_txcwrs1"),t.translate.get("Not too shabby at all, thanks","_txcwrs2"),t.translate.get("I guess you could say I feel wired all the time. Let me know how I can help!","_txcwrs3")]:[t.translate.get("Sorry, I didn't understand.","_txcwrs4"),t.translate.get("Sorry, I don't understand.","_txcwrs5")])[Math.floor(Math.random()*a.length)],"bot",n)}function g(e,n=""){return o+=1,mrAssets.hasOwnProperty("configuration")&&("repo"===n||o>4&&mrAssets.configuration.hasOwnProperty("botConfusion")?"custom"===mrAssets.configuration.botConfusion?t.controller.bot("_botConfusion",{kbAction:1,botAction:"all_KB"}):"system"===mrAssets.configuration.botConfusion&&h("botConfusion"):mrAssets.configuration.hasOwnProperty("notFound")&&("custom"===mrAssets.configuration.notFound?t.controller.bot("_notFound",{kbAction:1,botAction:"all_KB"}):"system"===mrAssets.configuration.notFound&&h("notFound")),t.conn.notification("Need Help!! Type help or menu"),e.hasOwnProperty("qs")&&mrAssets.configuration.hasOwnProperty("detectIssues")&&null!==firebase.auth().currentUser&&firebase.database().ref("training").push({uid:m(),time:Date.now(),type:"notFound",status:1,qs:e.qs})),t.common.typeLoader(!1)}function b(e,a){(async()=>{if(a!==n)return;let m=await async function(e,t){if(t!==n)return[];let a=elasticlunr(function(e){e.addField("que"),e.addField("tag"),e.setRef("key")});elasticlunr.clearStopWords=function(){elasticlunr.stopWordFilter.stopWords={}},elasticlunr.clearStopWords(),elasticlunr.addStopWords=function(e){null!=e&&!1!==Array.isArray(e)&&e.forEach(function(e){elasticlunr.stopWordFilter.stopWords[e]=!0},this)};const o=l;let i=await firebase.database().ref("knowledgeBase").orderByKey();return await i.once("value").then(function(t){let n=t.val();return n?(s=Object.keys(n).length,t.forEach(function(e){e.key;let t=e.val();t.hasOwnProperty("status")&&parseInt(t.status)>0&&("all_KB"===o?a.addDoc(t):"2"===t.status&&a.addDoc(t))}),a.search(e,{fields:{que:{boost:4},tag:{boost:3}}})):[]})}(e.qs,a);if(l="search",!(void 0!==typeof m&&m.length>0))return g(e);{let n=1200;i=1e3;let s=3;if(mrAssets&&mrAssets.hasOwnProperty("configuration")){let e=mrAssets.configuration;if(e&&e.hasOwnProperty("sb_power")){let t=parseFloat(e.sb_power);s=t>0?t:0}}if(m[0].score<=s)return g(e);o=0,function(e){e.hasOwnProperty("qs")&&(r===e.qs&&(c>4&&g(e,"repo"),c+=1),c=0,r=e.qs)}(e);let l=m[0].doc.ans?m[0].doc.ans:{};if(l&&l.constructor===Object&&Object.keys(l).length>0&&(d("kb",u(Object.values(m[0].doc.ans)[0]),"mr",a),i+=1e3),l&&l.constructor===Object&&Object.keys(l).length>1){let o=Object.assign({},Object.values(l).slice(1)),s=Object.keys(o).pop();Object.keys(o).forEach(function(r){let c=o[r];if(setTimeout(()=>{d("kb",u(c),"ma",a)},i+n*Math.random()),i+=1e3,r===s){let o=m[0].doc.rel;if(o&&o.length>0&&(setTimeout(()=>{d("rel",o,"ma",a)},i+n*Math.random()),i+=1e3),"kb"!==e.type&&""!==m[0].doc.type)try{let e=t.common.getCookie("mrRobotAutoAction"),a=parseInt(e)>0?parseInt(e):0;t.common.setCookie("mrRobotAutoAction",a+1,5),a<3?(setTimeout(()=>{p(m[0].doc)},i+n*Math.random()),i+=1e3):t.common.setCookie("mrRobotAutoAction",0,5)}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}}})}else{let e=m[0].doc.rel;if(e&&e.length>0&&(setTimeout(()=>{d("rel",e,"ma",a)},i+n*Math.random()),i+=1e3),""!==m[0].doc.act)try{let e=t.common.getCookie("mrRobotAutoAction"),n=parseInt(e)>0?parseInt(e):0;if(t.common.setCookie("mrRobotAutoAction",n+1,5),n<3)return i+=1e3,p(m[0].doc);t.common.setCookie("mrRobotAutoAction",0,5)}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}}}})()}function y(e,n,a=""){if(""===a)return;let o=firebase.auth().currentUser,s={};if(s.type=n,s.time=Date.now(),s.text=e,"bot"===n&&(s.text=e),o){let e=o.uid||null;t.conn.chatUsers&&("client"===n?s.name=t.conn.chatUsers.clientName||"Anonymous":"bot"===n&&(s.name=mrAssistantObj.name||"Mr. Assistant")),firebase.database().ref("livechat").child(e).push(s)}else t.common.localDB("mrAssistantOfflineChat","set",s),t.template.templateDark("offline-"+Math.floor(Math.random()*Math.floor(Date.now())),s,"message-visitor")}return{run:function(e,o){a=Object.assign({},o);try{n=t.common.getCookie("mrRobotSession");let a=["master","products","posts","pages","tags","author"];"master"===e.api?o.kbAction?(o.hasOwnProperty("botAction")&&"all_KB"===o.botAction&&(l="all_KB"),b(e,n)):o.sbAction&&master(e,n):"-1"!==a.indexOf(e.api)&&master(e,n)}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}return 0},saveMessage:y}}(),e.prototype.controller=function(){let e={};return{bot:function(n,a){return e=Object.assign({},a),t.searchEngine.run({api:"master",ks:"all",qs:n,att:{}},e)},mrCommandLine:function(e){"-mr allow adminchat"===e.toLowerCase()&&localStorage.setItem("mrAssistantChatItself",!1)}}}(),e.prototype.template=function(){function e(e="",t="",n=!0){return'<span class="mrtx" data-key="'+t+'" data-mode="'+n+'">'+e+"</span>"}function n(e,n,a,o){const s=document.createElement("DIV"),i=document.createElement("DIV");i.setAttribute("class","meg-wrapper"),s.setAttribute("class","message fade "+(""!==n.type?n.type:"bot")),s.setAttribute("id","mr"+e);const r=document.createElement("span");r.setAttribute("class","message-content"),r.appendChild(document.createTextNode(n.text));let c=`<p class="user">${n.name&&""!==n.name?n.name:function(e,n){if(("admin"===e||"client"===e)&&t.common.isset(mrUsers)&&mrUsers.hasOwnProperty(n)){let e=mrUsers[n];return e&&e.hasOwnProperty("name")?e.name:"Anonymous"}return mrAssistantObj&&mrAssistantObj.hasOwnProperty("name")?mrAssistantObj.name:"Mr. Assistant"}(n.type,n.uid||"")}</p>`,l="client"===n.type?"theme":"";if(i.innerHTML=c+'<span class="message-content '+l+'">'+n.text+"</span>","bot"!==n.type){const e=document.createElement("div");e.setAttribute("class","time"),e.appendChild(document.createTextNode(t.common.getDateTime(n.time))),s&&i.appendChild(e)}s.append(i);let m=document.createElement("DIV"),u=document.createElement("IMG");u.width=25,u.height=25;let d=Math.floor(92992343*Math.random()+1);m.setAttribute("class","avatar-wrapper"),u.setAttribute("class","avatar"),u.setAttribute("id","mrImg-"+d);let p=mrAssistantObj.plugin_url+"assets/images/mr-assistant.svg",f="";"bot"===n.type?(f=mrAssistantObj.hasOwnProperty("avatar")?mrAssistantObj.avatar:"",u.src=""!==f&&t.common.isValidURL(f)?f:p,s&&(m.append(u),s.prepend(m))):"admin"===n.type&&(f=n.hasOwnProperty("avatar")&&t.common.isValidURL(n.avatar)?n.avatar:function(e){let n=mrAssistantObj.plugin_url+"assets/images/boy.svg";try{if(""!==e&&t.common.isset(mrUsers)&&mrUsers.hasOwnProperty(e)){let t=mrUsers[e];if(t.hasOwnProperty("avatar")&&""!==t.avatar)return t.avatar}}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}return n}(n.uid||""),p=mrAssistantObj.plugin_url+"assets/images/boy.svg",u.src=f,s&&(m.append(u),s.prepend(m)));let h=document.getElementById("cbMessages");if(h){if("prepend"===o){h.prepend(s);let e=document.getElementById("cbMessages");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}else{h.appendChild(s);let e=document.getElementById("cbMessages");e&&e.scrollIntoView({behavior:"smooth",block:"end"})}t.common.image(d,f,p,"imgSrc"),t.common.typeLoader(!1)}}return{setAvatar:function(e,n){let a="",o="",s=0,i=mrAssistantObj.plugin_url+"assets",r=i+"/images/boy.svg",c=i+"/images/mr-assistant.svg",l=mrAssistantObj.hasOwnProperty("avatar")?mrAssistantObj.avatar:c,m=t.translate.get("Mr. Assistant","_txcwh8");for(let e in n)if(n.hasOwnProperty(e)){let i=n[e],u=Math.floor(8299432343*Math.random()+84);if(i.avatar&&i.avatar,"mr-assistant"===e&&"active"===i.status){s++,a+=(mrAssistantObj.name||m).split(/(\s).+\s/).join("")+", ";try{(new Image).src=l,o+='<div class="mr-avatar theme" id="mrImg-'+u+'"><img width="45" src="'+l+'"/></div>'}catch(e){o+='<div class="mr-avatar theme" id="mrImg-'+u+'"><img width="45" src="'+c+'"/></div>'}t.common.image(u,l,c,"img",45)}else if("person"===i.type&&"active"===i.status){s++,a+=i.name||", ";let e=i.hasOwnProperty("avatar")&&t.common.isValidURL(i.avatar)?i.avatar:r;try{(new Image).src=e,o+='<div class="mr-avatar theme" id="mrImg-'+u+'"><img width="45" src="'+e+'"/></div>'}catch(e){o+='<div class="mr-avatar theme" id="mrImg-'+u+'"><img width="45" src="'+r+'"/></div>'}t.common.image(u,e,r,"img",45)}}let u=t.translate.get("Chat With","_txcwh1");if(0===s){u=t.translate.get("Chat With","_txcwh6"),a=m,n.hasOwnProperty("mr-assistant")&&n["mr-assistant"].status&&"pulse"===n["mr-assistant"].status&&(u=t.translate.get("Hello there!","_txcwh9"),a=t.translate.get("I'm Mr. Assistant","_txcwh10"));let e=Math.floor(8294322343*Math.random()+44);o='<div class="mr-avatar theme" id="mrImg-'+e+'"><img width="45" src="'+l+'"/></div>',t.common.image(e,l,c,"img",45),s=1}let d=a.replace(/,(\s+)?$/,"");return['<div class="mr-avatars mr-ava-'+s+'">'+o+"</div >",'<h2 class="mr-live-person " title="'+d+'"><span class="mr-chat-with">'+u+"</span>"+d+"</h2>"].join("\n")},templateDark:function(e,t,a,o="append",s){let i=document.getElementById("client_id");return i&&i.value!==s?"":document.getElementById("mr"+e)?void 0:n(e,t,0,o)},flyTemplate:function(t,n="Mr. Assistant",a=""){return['<div class="close-introMessage">','<button type="button">','<span class="iconify" data-icon="ion:close"></span>',"</button>","</div>",'<div class="intro-container">','<img src="'+a+'" alt="'+n+'" class="avatar i-avatar">','<div style="margin-right: 20px;"><div class="i-avatar-name">'+n+'</div><div class="message-container">'+t+"</div>",'<div class="intro-start-btn theme"><span class="iconify" data-icon="bx:bxs-chat" data-inline="true"></span><span>&nbsp;&nbsp;'+e("Start Live Chat","_txcwi1")+"</span></div>","</div>","</div>"].join("\n")},chatTemplate:function(){const n=mrAssistantObj.plugin_url+"assets/images/mr-assistant.svg";let a=Math.floor(92992343*Math.random()+1),o=n;mrAssistantObj.hasOwnProperty("menu_avatar")&&t.common.isValidURL(mrAssistantObj.menu_avatar)&&(o=mrAssistantObj.menu_avatar),t.common.image(a,o,n,"imgSrc");let s="Search & Message...";return mrAssistantObj.hasOwnProperty("placeholder")&&""!==mrAssistantObj.placeholder&&(s=mrAssistantObj.placeholder),['<div class="chat-header theme">','<div class="mr-left-header">','<div class="mr-avatars">','<div class="mr-avatar theme"><img width="45" src="'+n+'"/></div>',"</div>",'<h2 class="mr-live-person "><span class="mr-chat-with">'+e("Chat with","_txcwh1")+" </span>Mr. Assistant</h2>","</div>",'<button class="close-chat material-icons" type="button">','<span class="iconify" data-icon="ion:close"></span>',"</button>",'<button class="mr-dropdown-btn material-icons" type="button">','<span class="iconify" data-icon="bx:bx-dots-vertical-rounded" data-inline="true"></span>',"</button>",'<div class="mr-dropdown theme" style="display: none"></div>','<div class="mr_status_box theme">','<span class="mr_status theme">Loading ...</span>',"</div>","</div>"].join("\n")+['<div id="cbBotMessages">','<div class="loadMore theme" data-inset="20" data-step="10" style="display: none;">Load More </div>','<div id="cbMessages" class="scrollbar">',"</div>","</div>"].join("\n")+['<div class="input-group">','<div class="drag-active-wrapper">','<button type="button" data-action="sleep" class="cb_bot material-icons">','<span class="iconify bot-line" data-icon="uil:line-alt" style="display: none"></span>','<span class="iconify" ><img id="mrImg-'+a+'" src="'+o+'" width="30" height="30" class="theme"/></span>',"</button>",'<button type="button" class="cb_info material-icons">','<span class="iconify" data-icon="icomoon-free:info"></span>',"</button>",'<button type="button" class="mr_menus material-icons">','<span class="iconify" data-icon="ion:menu" data-inline="false"></span>',"</button>",'<button type="button" style="display: none" class="cb_expend iconify material-icons">','<span class="iconify" data-icon="mdi:chevron-right"></span>',"</button>",'<div id="message-form" style="display: flex;width: 100%">','<input id="mrCrts" type="hidden"/>','<input id="message" placeholder="'+s+'" type="text" autocomplete="off"/>','<button  id="mr_sender" class="material-icons">','<span class="iconify" data-icon="mdi:send"></span>',"</button>","</div>","</div>","</div>"].join("\n")},menuView:function(e,n){try{let a="menuContext"===e?"mr-single-menu-context":"mr-single-menu";mrAssistantObj.domain;if(mrAssistantObj.upload_dir&&mrAssistantObj.upload_dir,"redirectAction"===n.menuAction){if(n.actionContext&&""!==n.actionContext)try{if(t.common.isValidURL(n.actionContext)){new URL(n.actionContext);let e=window.open(n.actionContext,"_blank");if(e&&!e.closed&&void 0!==e.closed)return e.focus();t.init.popMessage({title:"Page Suggestion",content:"Click this button to open this page.",type:"redirect",button:"Open Page",action:n.actionContext})}}catch(e){"on"===mrAssistantObj.dev&&console.info(e)}}else if("searchAction"===n.menuAction){if(n.actionContext&&""!==n.actionContext)return t.common.setCookie("mrRobotAutoAction",0,5),t.common.setCookie("mrRobotSession",t.common.generateGUID(),5),t.controller.bot(n.actionContext,{cuAction:1,kbAction:1,sbAction:1})}else if("kb"===n.menuAction){if(n.actionContext&&""!==n.actionContext)return t.controller.bot(n.actionContext,{cuAction:0,kbAction:1,sbAction:0})}else if("help"===n.menuAction){const e=document.querySelector(".cb_info");e&&e.click()}else if("menu"===n.menuAction){const e=document.querySelector(".mr_menus");e&&e.click()}else if("cart"===n.menuAction){const e=document.querySelector(".cb_cart");e&&e.click()}else"rate"===n.menuAction&&t.form.feedbackForm("feedback");if(t.common.typeLoader(!1),n.hasOwnProperty("menuAction")&&"contextAction"!==n.menuAction){const e=document.querySelector(".alc_pop_box"),t=window.frameElement;return e&&(e.innerHTML=""),t.style.width="430px",t.style.height="100vh",""}return['<div class="single-item cb-shadow-1 '+a+'" style="display: block">','<div class="close_btn" type="button">X</div>','<section class="single-menu-item">','<div class="single-menu-title" title="'+n.menuName+'">'+n.menuName+"</div>",'<div class="single-menu-description">'+n.menuContext+"</div>","</section>","</div>"].join("\n")}catch(e){}}}}(),e.prototype.form=function(){let e=!1;function n(n={},a="",o=!1){firebase.auth().onAuthStateChanged(function(o){if(!e)return;let s=localStorage.getItem("mrAssistantChatItself");if(o||s){if(s){const e=document.querySelectorAll(".signUpForm");e&&e.forEach(e=>e.remove());let n=document.querySelector(".errors");n&&(n.innerHTML="Hello Admin!! Please log in from your admin control panel."),t.conn.setMessages("Hello Admin!! Please log in from your admin control panel.",o,"bot"),t.conn.notification("Hello Admin!! Please log in from your admin control panel.")}}else{let o="Anonymous "+Date.now().toString().substr(3),s={name:n.name||o,email:n.email||"",gdpr:n.hasOwnProperty("gdpr")?n.gdpr:0,isNewUser:!1,marge:!1,join:Date.now(),chatWay:"SignUp",method:"SignUp",type:"liveChat",lastSeen:Date.now(),status:"active",currentPage:window.location.href,browser:t.common.getBrowser(),languages:navigator.languages.join(", "),language:navigator.languages.join(","),platform:navigator.platform};firebase.auth().signInAnonymously().then(n=>{e=!1;var o=n.user;if(o){if("survey"===a){const e=document.querySelectorAll(".signUpForm");e&&e.forEach(e=>e.remove())}t.conn.notification("Success!! Now you can chat or search..."),s.uid=o.uid,firebase.database().ref("clients").child(o.uid).child("info").set(s),t.conn._conversationInit(),t.conn.setMessages("Hello "+s.name+"!! Thank you for Sign Up.",o,"bot"),t.controller.bot("_preChat",{kbAction:1,botAction:"all_KB"})}}).catch(function(e){"on"===mrAssistantObj.dev&&console.info(e)})}})}function a(o){o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation(),e=!0,setTimeout(function(e){var t=document.querySelectorAll(".mrSurveyForm .mr-survey-save");t&&t.forEach(e=>{e.removeEventListener("click",a,!1)})},100);let s=t.common.getObject(".cbSurveyForm .mrInput");var i=function(e){let t=/\S+@\S+\.\S+/;if(e.hasOwnProperty("name")&&e.name.length>2)return e.hasOwnProperty("email")&&t.test(e.email)?"on"===(mrAssistantObj.hasOwnProperty("gdpr_check")?mrAssistantObj.gdpr_check:"off")?e.hasOwnProperty("gdpr")&&1===e.gdpr?"valid":"Please check GDPR Compliance.":"valid":"Please add your valid email address.";return"Name must be minimum 3 letters."}(s);if("valid"===i)if(null!==firebase.auth().currentUser){let e=firebase.auth().currentUser.uid;e&&firebase.database().ref("clients").child(e).child("info").update(s)}else e&&n(s,"survey");else{let e=document.querySelector(".errors");e&&(e.innerHTML=i),t.conn.notification(i)}if(null!==firebase.auth().currentUser){const e=document.querySelectorAll(".signUpForm");e&&e.forEach(e=>e.remove())}}function o(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=e.target.dataset.action,n=(e.target.dataset.key,e.target.value);if("text"===t)if("email"===e.target.type){e.target.value=n.replace(/[^\w\s.@]+/g,"");/\S+@\S+\.\S+/.test(e.target.value)?e.target.style.borderColor="green":e.target.style.borderColor="red"}else e.target.value=n.replace(/[^\w\s.&-]+/g,""),""!==e.target.value?e.target.style.borderColor="green":e.target.style.borderColor="red"}function s(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),setTimeout(function(e){var t=document.querySelectorAll(".mrSurveyForm .mr-survey-save");t&&t.forEach(e=>{e.removeEventListener("click",s,!1)})},100);let n=document.getElementById("feedback-input"),a=document.querySelector("input[name='rate']:checked"),o=e.target.dataset.type;if(null!==firebase.auth().currentUser){let e=firebase.auth().currentUser,s=e.uid;s&&a.value>0?firebase.database().ref("clients").child(s).child("info").update({rate:a.value,feedback:n.value,lastSeen:Date.now()}).then(function(){if("feedbackAndSignOut"===o){const e=document.querySelector(".cbMessages");e&&(e.innerHTML=""),firebase.auth().signOut().then(function(){return i("signUp")})}t.conn.notification("Thank you for your Feedback."),t.conn.setMessages("Thank you for your Feedback.",e,"bot");const n=document.querySelectorAll(".signUpForm");n&&n.forEach(e=>e.remove())}):t.conn.notification("Please Rate Us!!")}}function i(e){t.common.mrLoader(!0),t.conn.notification("Please introduce yourself:");let n=mrAssistantObj.plugin_url+"assets/images/boy.svg",s=mrAssistantObj.hasOwnProperty("gdpr_check")?mrAssistantObj.gdpr_check:"off",i=mrAssistantObj.hasOwnProperty("gdpr")&&""!==mrAssistantObj.gdpr?mrAssistantObj.gdpr:"",r=mrAssistantObj.hasOwnProperty("policy_url")&&t.common.isValidURL(mrAssistantObj.policy_url)?`<a href="${mrAssistantObj.policy_url}" target="_blank">more</a>`:"";var c=['<div class="mrSurveyForm">','<button style="display:none" class="sf_close_btn" type="button">X</button>','<div class="cbSurveyForm ">',`<div class="signUpImg theme"><img src="${n}" width="80"/></div>`,'<div class="survey-input survey_text"><span>Please introduce yourself:</span></div>','<input type="text" data-key="name" data-action="text" class="mrInput survey-input" placeholder="Type Name..."/>','<input type="email" data-key="email" data-action="text" class="mrInput survey-input" placeholder="Type Email..."/>',"on"===s?`<label class="mrCheckBox" for="gdpr"><input required type="checkbox" id="gdpr" data-key="gdpr" data-action="checkbox" class="mrInput survey-input"/>${i+r}</label>`:"",'<div class="errors"></div>','<input type="button" class="mr-survey-save theme" value="Start Chat"/>',"</div>","</div>"].join(""),l=document.querySelector("#cbMessages"),m=document.createElement("DIV");m.setAttribute("class","signUpForm"),m.innerHTML=c;const u=document.querySelectorAll(".signUpForm");u&&u.forEach(e=>e.remove()),l.appendChild(m),setTimeout(function(e){var t=l.querySelectorAll(".mrSurveyForm .mr-survey-save");t&&t.forEach(e=>{e.addEventListener("click",a,!0)});let n=m.querySelectorAll(".cbSurveyForm .mrInput");n&&n.forEach(e=>{e.addEventListener("input",o,!0)})},2e3),t.common.mrLoader(!1)}return{signUp:n,surveyForm:i,feedbackForm:function(e=""){t.common.mrLoader(!0),"feedbackAndSignOut"===e?t.conn.notification("Please Provide your Feedback before leave chat"):t.conn.notification("Please Rate Us or Provide Feedback:");var n=['<div class="mrSurveyForm">','<button style="display:none" class="sf_close_btn" type="button">X</button>','<div class="cbSurveyForm ">',`<div class="signUpImg theme"><img src="${mrAssistantObj.plugin_url+"assets/images/boy.svg"}" width="80"/></div>`,'<div class="survey-input survey_text"><span>Please Rate Us or Provide Feedback: </span></div>','<div class="rate">','<input type="radio" id="mr_star5" name="rate" value="5"/>','<label for="mr_star5" title="5 stars">5 stars</label>','<input type="radio" id="mr_star4" name="rate" value="4"/>','<label for="mr_star4" title="4 stars">4 stars</label>','<input type="radio" id="mr_star3" name="rate" value="3"/>','<label for="mr_star3" title="3 stars">3 stars</label>','<input type="radio" id="mr_star2" name="rate" value="2"/>','<label for="mr_star2" title="2 stars">2 stars</label>','<input type="radio" id="mr_star1" name="rate" value="1"/>','<label for="mr_star1" title="1 star">1 star</label>',"</div>",'<textarea id="feedback-input" placeholder="Type Your Feedback..." rows="4" cols="30"></textarea>',`<input type="button" class="mr-survey-save theme" data-type="${e}" value="SEND FEEDBACK"/>`,"</div>","</div>"].join(""),a=document.querySelector("#cbMessages"),o=document.createElement("DIV");o.setAttribute("class","signUpForm"),o.innerHTML=n;const i=document.querySelectorAll(".signUpForm");i&&i.forEach(e=>e.remove()),a.appendChild(o),setTimeout(function(e){var t=a.querySelectorAll(".mrSurveyForm .mr-survey-save");t&&t.forEach(e=>{e.addEventListener("click",s,!0)})},2e3),t.common.mrLoader(!1)}}}(),document.addEventListener("readystatechange",t=>{if("complete"===t.target.readyState){if("mr-assistant-chat-bot-client"===document.getElementsByTagName("BODY")[0].getAttribute("data-action")){(new e).init.execute()}}})}();